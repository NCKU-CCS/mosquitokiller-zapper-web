{"version":3,"sources":["app.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","initMap","map","L","setView","countryView","tileLayer","attribution","maxZoom","id","accessToken","addTo","$","hide","fadeIn","weekEggLegend","control","position","onAdd","div","DomUtil","create","grades","innerHTML","getIconStyleRGBA","on","selectedClass","this","val","prop","css","datepickerOnChange","availableDatesInInterval","dataInInterval","startDate","moment","endDate","console","log","availableDates","forEach","d","thisDay","push","thisDayKey","format","getCount","insertBucketList","renderEvent","dateDataMap","hasStartDate","hasEndDate","empty","clearMap","getKeys","info","setMapTitle","date","thisDayCountData","count","lamp","bucketJson","find","lamp_id","insertBucketHtml","getPlaceName","place_id","bindPopups","_loop","bucket","insertHTML","tz","updated_at","append","obj","Object","keys","err","mapTitle","title","eventJson","event","latlng","mcc_center","radius","mccDistanceLowerLimit","circle","circles","markerArray","marker","removeLayer","remove","lat","lamp_location","lng","icon","iconUrl","getIconStyle","iconSize","popupAnchor","iconAnchor","className","getIconCat","PopUpContent","bindPopup","amount","style","String","prototype","args","arguments","replace","match","number","countJson","placeJson","locale","getPlaceNameFunc","placeMap","place_name","getCountFunc","countMap","dateData","sum","台南","高雄","屏東","document","ready","datepicker","autoclose","zIndexOffset","reqPromises","url","ajax","dataType","type","Promise","all","then","res","distance_lower_limit"],"mappings":"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","file":"../app.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\nif (!String.prototype.format) {\n  String.prototype.format = function () {\n    var args = arguments;\n    return this.replace(/{(\\d+)}/g, function (match, number) {\n      return typeof args[number] !== 'undefined' ? args[number] : match;\n    });\n  };\n}\n\nvar bucketJson = {};\nvar eventJson = {};\nvar locationJson = {};\nvar countJson = {};\nvar placeJson = {};\nvar mccDistanceLowerLimit = void 0;\nvar map = void 0;\nvar markerArray = [];\nvar circles = [];\nvar getPlaceName = void 0;\nvar getCount = void 0;\nvar availableDates = void 0;\n\nmoment.locale('zh-tw');\n\nvar getPlaceNameFunc = function getPlaceNameFunc(placeJson) {\n  var placeMap = {};\n  placeJson.forEach(function (d) {\n    placeMap[d.place_id] = d.place_name;\n  });\n  return function (id) {\n    return placeMap[id];\n  };\n};\n\nvar getCountFunc = function getCountFunc(countJson) {\n  var countMap = {};\n  availableDates.forEach(function (d) {\n    countMap[d] = {};\n  });\n  for (var i in countJson) {\n    var dateData = countJson[i];\n    for (var id in dateData) {\n      countMap[i][id] = dateData[id].sum;\n    }\n  }\n  return function (date) {\n    return countMap[date];\n  };\n};\nvar countryView = {\n  '台南': [22.9971, 120.1926],\n  '高雄': [22.6397615, 120.2999183],\n  '屏東': [22.667431, 120.486307]\n};\n\n$(document).ready(function () {\n  setMapTitle('資料載入中...');\n  $('.range-start').datepicker({\n    'autoclose': true,\n    'zIndexOffset': 1000,\n    'format': 'yyyy-mm-dd'\n  }).on('changeDate', datepickerOnChange);\n  $('.range-end').datepicker({\n    'autoclose': true,\n    'zIndexOffset': 1000,\n    'format': 'yyyy-mm-dd'\n  }).on('changeDate', datepickerOnChange);\n\n  var root_url = 'http://140.116.249.228:3000/apis/';\n  var urls = ['lamps', 'rules', 'mcc', 'counts', 'places'];\n  var reqPromises = urls.map(function (url) {\n    return $.ajax({\n      // url: root_url + url,\n      url: url + '.json',\n      dataType: \"JSON\",\n      type: \"GET\"\n    });\n  });\n\n  Promise.all(reqPromises).then(function (res) {\n    bucketJson = res[0]['lamps'];\n    mccDistanceLowerLimit = res[1]['rules'][0].distance_lower_limit;\n    eventJson = res[2]['mcc'];\n    countJson = res[3]['counts'];\n    placeJson = res[4]['places'];\n\n    console.log(res);\n\n    availableDates = getKeys(countJson);\n    getPlaceName = getPlaceNameFunc(placeJson);\n    getCount = getCountFunc(countJson);\n    initMap();\n    setMapTitle('請選擇日期區間');\n  });\n});\n\nfunction initMap() {\n  map = L.map('map').setView(countryView[\"台南\"], 14);\n\n  L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/dark-v9/tiles/256/{z}/{x}/{y}?access_token={accessToken}', {\n    attribution: 'Map data &copy; <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, Imagery © <a href=\"http://mapbox.com\">Mapbox</a>',\n    maxZoom: 18,\n    id: 'ching56.17hng6ja',\n    accessToken: 'pk.eyJ1IjoiY2hpbmc1NiIsImEiOiJjaXNiZmYydGMwMTN1MnpwbnNqNWVqM2plIn0.k7h-PUGX7Tl5xLwDH3Qpsg'\n  }).addTo(map);\n  $(\"#map\").hide();\n  $(\"#map\").fadeIn();\n\n  var weekEggLegend = L.control({\n    position: 'bottomright'\n  });\n\n  weekEggLegend.onAdd = function () {\n    var div = L.DomUtil.create('div', 'info legend'),\n        grades = [0, 1, 50, 100, 150, 200];\n\n    div.innerHTML += '<span class = \"legend-header\">捕獲數（個）<hr>';\n    for (var i = 0; i < grades.length; i++) {\n      if (grades[i] === 0) {\n        div.innerHTML += '<div class=\" barrel_legend\" id=\"grade_' + i + '\">' + '<i style=\"background:' + getIconStyleRGBA(grades[i]) + '\"></i>' + grades[i] + '<br></div>';\n      } else {\n        div.innerHTML += '<div class=\" barrel_legend\" id=\"grade_' + i + '\">' + '<i style=\"background:' + getIconStyleRGBA(grades[i]) + '\"></i>' + grades[i] + (grades[i + 1] ? ' &ndash; ' + (grades[i + 1] - 1) + '<br></div>' : ' <br></div>');\n      }\n    }\n\n    div.innerHTML += '<div class=\" barrel_legend\" id=\"grade_other\">' + '<i style=\"background:#cccccc\"></i>' + '無資料' + '<br></div>';\n\n    return div;\n  };\n\n  weekEggLegend.addTo(map);\n  $(\".barrel_legend > input\").on(\"click\", function () {\n    var selectedClass = '.' + $(this).val();\n    if ($(this).prop(\"checked\")) {\n      $(selectedClass).css('display', 'block');\n    } else {\n      $(selectedClass).css('display', 'none');\n    }\n  });\n}\n\nfunction datepickerOnChange() {\n  var availableDatesInInterval = [];\n  var dataInInterval = {};\n  var startDate = moment($('.range-start').val());\n  var endDate = moment($('.range-end').val());\n  console.log('trigger change');\n\n  if (startDate === '' || endDate === '') return;\n\n  availableDates.forEach(function (d) {\n    var thisDay = moment(d);\n    if (thisDay >= startDate && thisDay <= endDate) {\n      availableDatesInInterval.push(thisDay);\n    }\n  });\n\n  availableDatesInInterval.forEach(function (d) {\n    var thisDayKey = d.format('YYYY-MM-DD');\n    dataInInterval[thisDayKey] = getCount(thisDayKey);\n  });\n\n  insertBucketList(dataInInterval);\n  renderEvent();\n}\n\nfunction insertBucketList(dateDataMap) {\n  var hasStartDate = !($('.range-start').val() === '');\n  var hasEndDate = !($('.range-end').val() === '');\n  var startDate = hasStartDate ? moment($('.range-start').val()).format('YYYY-MM-DD') : '未選擇起始日期';\n  var endDate = hasEndDate ? moment($('.range-end').val()).format('YYYY-MM-DD') : '未選擇結束日期';\n  $(\".map-container .list-group\").empty();\n  clearMap();\n\n  if (getKeys(dateDataMap).length === 0) {\n    var info = '沒有資料';\n    if (!hasEndDate || !hasStartDate) {\n      info = '';\n    }\n    setMapTitle(startDate + ' ~ ' + endDate + ' ' + info);\n  } else {\n    setMapTitle(startDate + ' ~ ' + endDate + ' \\u5340\\u9593\\u8CC7\\u6599');\n  }\n\n  for (var date in dateDataMap) {\n    var thisDayCountData = dateDataMap[date];\n\n    var _loop = function _loop(id) {\n      var count = thisDayCountData[id];\n      var lamp = bucketJson.find(function (d) {\n        return d.lamp_id === id;\n      });\n      var place = getPlaceName(lamp.place_id);\n      insertBucketHtml(place, lamp, count);\n      bindPopups(lamp, count);\n    };\n\n    for (var id in thisDayCountData) {\n      _loop(id);\n    }\n  }\n\n  $('#map').fadeIn();\n}\n\nfunction insertBucketHtml(info, bucket, count) {\n  var insertHTML = '<a class=\"list-group-item \">\\n        <h4 class=\"list-group-item-heading\"><span>' + bucket.lamp_id + '@' + info + '</span><span>&#9889;' + count + '</span></h4>\\n        <p class=\"list-group-item-text\"> ' + moment.tz(bucket.updated_at, 'Asia/Taipei').format('LLL') + '</p>\\n      </a>';\n  $(\".map-container .list-group\").append(insertHTML);\n}\n\nfunction getKeys(obj) {\n  try {\n    var keys = Object.keys(obj);\n    return keys;\n  } catch (err) {\n    return [];\n  }\n}\n\nfunction setMapTitle(mapTitle) {\n  // clear loading text \n  console.log('set title', mapTitle);\n  var title = $('<h3>' + mapTitle + '</h3>');\n  $('.list-group').empty();\n  $('.list-group').append(title);\n\n  title.hide();\n  title.fadeIn('slow');\n}\n\nfunction renderEvent(date) {\n  eventJson.forEach(function (event) {\n    var latlng = [event.mcc_center[1], event.mcc_center[0]];\n    var radius = mccDistanceLowerLimit;\n    var circle = L.circle(latlng, {\n      radius: radius\n    });\n    circles.push(circle);\n    circle.addTo(map);\n  });\n}\n\nfunction clearMap() {\n  markerArray.forEach(function (marker) {\n    map.removeLayer(marker);\n  });\n\n  circles.forEach(function (circle) {\n    circle.remove();\n  });\n\n  circles = [];\n\n  $(\"#map\").hide();\n}\n\nfunction bindPopups(lamp, count) {\n\n  var SCALE = 80;\n\n  var lat = lamp.lamp_location[1];\n  var lng = lamp.lamp_location[0];\n\n  var icon = L.icon({\n    iconUrl: getIconStyle(count),\n    iconSize: [45, 80], // size of the icon\n    popupAnchor: [0, -40],\n    iconAnchor: [22, 60],\n    className: getIconCat(count)\n  });\n\n  var PopUpContent = ('<table>' + '<tr>' + '<th> ID </th>' + '<td> {0} </td>' + '</tr>' + '<tr>' + '<th>地點</th>' + '<td>{1}</td>' + '</tr>' + '<tr>' + '<th>捕獲</th>' + '<td>{2}</td>' + '</tr>' + '</table>').format(lamp.lamp_id, getPlaceName(lamp.place_id), count);\n\n  var marker = L.marker([lat, lng], {\n    icon: icon\n  }).bindPopup(PopUpContent).addTo(map);\n  markerArray.push(marker);\n}\n\nfunction getIconStyle(amount) {\n  var style;\n  if (amount === 0) {\n    style = 'legend1';\n  } else if (amount > 0 && amount <= 49) {\n    style = 'legend2';\n  } else if (amount >= 50 && amount <= 99) {\n    style = 'legend3';\n  } else if (amount >= 100 && amount <= 149) {\n    style = 'legend4';\n  } else if (amount >= 150 && amount <= 199) {\n    style = 'legend5';\n  } else if (amount >= 200) {\n    style = 'legend6';\n  } else {\n    style = 'legend_undefined';\n  }\n  return 'images/' + style + '.svg';\n}\n\nfunction getIconCat(amount) {\n  var category;\n  if (amount === 0) {\n    category = 'grade_0';\n  } else if (amount > 0 && amount <= 49) {\n    category = 'grade_1';\n  } else if (amount >= 50 && amount <= 99) {\n    category = 'grade_2';\n  } else if (amount >= 100 && amount <= 149) {\n    category = 'grade_3';\n  } else if (amount >= 150 && amount <= 199) {\n    category = 'grade_4';\n  } else if (amount >= 200) {\n    category = 'grade_5';\n  } else {\n    category = 'grade_other';\n  }\n  return category;\n}\n\nfunction getIconStyleRGBA(amount) {\n  var style;\n  if (amount === 0) {\n    style = '#00FF9D';\n  } else if (amount > 0 && amount <= 49) {\n    style = '#33CC7E';\n  } else if (amount >= 50 && amount <= 99) {\n    style = '#66995E';\n  } else if (amount >= 100 && amount <= 149) {\n    style = '#99663F';\n  } else if (amount >= 150 && amount <= 199) {\n    style = '#CC331F';\n  } else if (amount >= 200) {\n    style = '#FF0000';\n  }\n\n  return style;\n}\n\n},{}]},{},[1])\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYXBwLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNBQSxJQUFJLENBQUMsT0FBTyxTQUFQLENBQWlCLE1BQXRCLEVBQThCO0FBQzVCLFNBQU8sU0FBUCxDQUFpQixNQUFqQixHQUEwQixZQUFZO0FBQ3BDLFFBQU0sT0FBTyxTQUFiO0FBQ0EsV0FBTyxLQUFLLE9BQUwsQ0FBYSxVQUFiLEVBQXlCLFVBQVUsS0FBVixFQUFpQixNQUFqQixFQUF5QjtBQUN2RCxhQUFPLE9BQU8sS0FBSyxNQUFMLENBQVAsS0FBd0IsV0FBeEIsR0FBc0MsS0FBSyxNQUFMLENBQXRDLEdBQXFELEtBQTVEO0FBQ0QsS0FGTSxDQUFQO0FBR0QsR0FMRDtBQU1EOztBQUVELElBQUksYUFBYSxFQUFqQjtBQUNBLElBQUksWUFBWSxFQUFoQjtBQUNBLElBQUksZUFBZSxFQUFuQjtBQUNBLElBQUksWUFBWSxFQUFoQjtBQUNBLElBQUksWUFBWSxFQUFoQjtBQUNBLElBQUksOEJBQUo7QUFDQSxJQUFJLFlBQUo7QUFDQSxJQUFJLGNBQWMsRUFBbEI7QUFDQSxJQUFJLFVBQVUsRUFBZDtBQUNBLElBQUkscUJBQUo7QUFDQSxJQUFJLGlCQUFKO0FBQ0EsSUFBSSx1QkFBSjs7QUFFQSxPQUFPLE1BQVAsQ0FBYyxPQUFkOztBQUVBLElBQUksbUJBQW1CLFNBQW5CLGdCQUFtQixDQUFVLFNBQVYsRUFBcUI7QUFDMUMsTUFBSSxXQUFXLEVBQWY7QUFDQSxZQUFVLE9BQVYsQ0FBa0IsVUFBVSxDQUFWLEVBQWE7QUFDN0IsYUFBUyxFQUFFLFFBQVgsSUFBdUIsRUFBRSxVQUF6QjtBQUNELEdBRkQ7QUFHQSxTQUFPLFVBQVUsRUFBVixFQUFjO0FBQ25CLFdBQU8sU0FBUyxFQUFULENBQVA7QUFDRCxHQUZEO0FBR0QsQ0FSRDs7QUFVQSxJQUFJLGVBQWUsU0FB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LEdBQVYsSUFBaUIsVUFBVSxHQUEvQixFQUFvQztBQUN6QyxlQUFXLFNBQVg7QUFDRCxHQUZNLE1BRUEsSUFBSSxVQUFVLEdBQWQsRUFBbUI7QUFDeEIsZUFBVyxTQUFYO0FBQ0QsR0FGTSxNQUVBO0FBQ0wsZUFBVyxhQUFYO0FBQ0Q7QUFDRCxTQUFPLFFBQVA7QUFDRDs7QUFFRCxTQUFTLGdCQUFULENBQTBCLE1BQTFCLEVBQWtDO0FBQ2hDLE1BQUksS0FBSjtBQUNBLE1BQUksV0FBVyxDQUFmLEVBQWtCO0FBQ2hCLFlBQVEsU0FBUjtBQUNELEdBRkQsTUFFTyxJQUFJLFNBQVMsQ0FBVCxJQUFjLFVBQVUsRUFBNUIsRUFBZ0M7QUFDckMsWUFBUSxTQUFSO0FBQ0QsR0FGTSxNQUVBLElBQUksVUFBVSxFQUFWLElBQWdCLFVBQVUsRUFBOUIsRUFBa0M7QUFDdkMsWUFBUSxTQUFSO0FBQ0QsR0FGTSxNQUVBLElBQUksVUFBVSxHQUFWLElBQWlCLFVBQVUsR0FBL0IsRUFBb0M7QUFDekMsWUFBUSxTQUFSO0FBQ0QsR0FGTSxNQUVBLElBQUksVUFBVSxHQUFWLElBQWlCLFVBQVUsR0FBL0IsRUFBb0M7QUFDekMsWUFBUSxTQUFSO0FBQ0QsR0FGTSxNQUVBLElBQUksVUFBVSxHQUFkLEVBQW1CO0FBQ3hCLFlBQVEsU0FBUjtBQUNEOztBQUVELFNBQU8sS0FBUDtBQUNEIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsImlmICghU3RyaW5nLnByb3RvdHlwZS5mb3JtYXQpIHtcbiAgU3RyaW5nLnByb3RvdHlwZS5mb3JtYXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgYXJncyA9IGFyZ3VtZW50cztcbiAgICByZXR1cm4gdGhpcy5yZXBsYWNlKC97KFxcZCspfS9nLCBmdW5jdGlvbiAobWF0Y2gsIG51bWJlcikge1xuICAgICAgcmV0dXJuIHR5cGVvZiBhcmdzW251bWJlcl0gIT09ICd1bmRlZmluZWQnID8gYXJnc1tudW1iZXJdIDogbWF0Y2g7XG4gICAgfSlcbiAgfTtcbn1cblxubGV0IGJ1Y2tldEpzb24gPSB7fVxubGV0IGV2ZW50SnNvbiA9IHt9XG5sZXQgbG9jYXRpb25Kc29uID0ge31cbmxldCBjb3VudEpzb24gPSB7fVxubGV0IHBsYWNlSnNvbiA9IHt9XG5sZXQgbWNjRGlzdGFuY2VMb3dlckxpbWl0XG5sZXQgbWFwO1xubGV0IG1hcmtlckFycmF5ID0gW107XG5sZXQgY2lyY2xlcyA9IFtdXG5sZXQgZ2V0UGxhY2VOYW1lXG5sZXQgZ2V0Q291bnRcbmxldCBhdmFpbGFibGVEYXRlc1xuXG5tb21lbnQubG9jYWxlKCd6aC10dycpXG5cbmxldCBnZXRQbGFjZU5hbWVGdW5jID0gZnVuY3Rpb24gKHBsYWNlSnNvbikge1xuICB2YXIgcGxhY2VNYXAgPSB7fVxuICBwbGFjZUpzb24uZm9yRWFjaChmdW5jdGlvbiAoZCkge1xuICAgIHBsYWNlTWFwW2QucGxhY2VfaWRdID0gZC5wbGFjZV9uYW1lXG4gIH0pXG4gIHJldHVybiBmdW5jdGlvbiAoaWQpIHtcbiAgICByZXR1cm4gcGxhY2VNYXBbaWRdXG4gIH1cbn1cblxudmFyIGdldENvdW50RnVuYyA9IChjb3VudEpzb24pID0+IHtcbiAgbGV0IGNvdW50TWFwID0ge31cbiAgYXZhaWxhYmxlRGF0ZXMuZm9yRWFjaCgoZCkgPT4ge1xuICAgIGNvdW50TWFwW2RdID0ge31cbiAgfSlcbiAgZm9yIChsZXQgaSBpbiBjb3VudEpzb24pIHtcbiAgICBsZXQgZGF0ZURhdGEgPSBjb3VudEpzb25baV1cbiAgICBmb3IgKGxldCBpZCBpbiBkYXRlRGF0YSlcbiAgICAgIGNvdW50TWFwW2ldW2lkXSA9IGRhdGVEYXRhW2lkXS5zdW1cbiAgfVxuICByZXR1cm4gKGRhdGUpID0+IHtcbiAgICByZXR1cm4gY291bnRNYXBbZGF0ZV1cbiAgfVxufVxudmFyIGNvdW50cnlWaWV3ID0ge1xuICAn5Y+w5Y2XJzogWzIyLjk5NzEsIDEyMC4xOTI2XSxcbiAgJ+mrmOmbhCc6IFsyMi42Mzk3NjE1LCAxMjAuMjk5OTE4M10sXG4gICflsY/mnbEnOiBbMjIuNjY3NDMxLCAxMjAuNDg2MzA3XVxufVxuXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gIHNldE1hcFRpdGxlKCfos4fmlpnovInlhaXkuK0uLi4nKVxuICAkKCcucmFuZ2Utc3RhcnQnKS5kYXRlcGlja2VyKHtcbiAgICAnYXV0b2Nsb3NlJzogdHJ1ZSxcbiAgICAnekluZGV4T2Zmc2V0JzogMTAwMCxcbiAgICAnZm9ybWF0JzogJ3l5eXktbW0tZGQnXG4gIH0pLm9uKCdjaGFuZ2VEYXRlJywgZGF0ZXBpY2tlck9uQ2hhbmdlKVxuICAkKCcucmFuZ2UtZW5kJykuZGF0ZXBpY2tlcih7XG4gICAgJ2F1dG9jbG9zZSc6IHRydWUsXG4gICAgJ3pJbmRleE9mZnNldCc6IDEwMDAsXG4gICAgJ2Zvcm1hdCc6ICd5eXl5LW1tLWRkJ1xuICB9KS5vbignY2hhbmdlRGF0ZScsIGRhdGVwaWNrZXJPbkNoYW5nZSlcblxuICB2YXIgcm9vdF91cmwgPSAnaHR0cDovLzE0MC4xMTYuMjQ5LjIyODozMDAwL2FwaXMvJ1xuICB2YXIgdXJscyA9IFsnbGFtcHMnLCAncnVsZXMnLCAnbWNjJywgJ2NvdW50cycsICdwbGFjZXMnXTtcbiAgdmFyIHJlcVByb21pc2VzID0gdXJscy5tYXAoZnVuY3Rpb24gKHVybCkge1xuICAgIHJldHVybiAkLmFqYXgoe1xuICAgICAgLy8gdXJsOiByb290X3VybCArIHVybCxcbiAgICAgIHVybDogdXJsICsgJy5qc29uJyxcbiAgICAgIGRhdGFUeXBlOiBcIkpTT05cIixcbiAgICAgIHR5cGU6IFwiR0VUXCJcbiAgICB9KTtcbiAgfSk7XG5cbiAgUHJvbWlzZS5hbGwocmVxUHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24gKHJlcykge1xuICAgIGJ1Y2tldEpzb24gPSByZXNbMF1bJ2xhbXBzJ11cbiAgICBtY2NEaXN0YW5jZUxvd2VyTGltaXQgPSByZXNbMV1bJ3J1bGVzJ11bMF0uZGlzdGFuY2VfbG93ZXJfbGltaXRcbiAgICBldmVudEpzb24gPSByZXNbMl1bJ21jYyddXG4gICAgY291bnRKc29uID0gcmVzWzNdWydjb3VudHMnXVxuICAgIHBsYWNlSnNvbiA9IHJlc1s0XVsncGxhY2VzJ11cblxuICAgIGNvbnNvbGUubG9nKHJlcylcblxuICAgIGF2YWlsYWJsZURhdGVzID0gZ2V0S2V5cyhjb3VudEpzb24pXG4gICAgZ2V0UGxhY2VOYW1lID0gZ2V0UGxhY2VOYW1lRnVuYyhwbGFjZUpzb24pXG4gICAgZ2V0Q291bnQgPSBnZXRDb3VudEZ1bmMoY291bnRKc29uKVxuICAgIGluaXRNYXAoKTtcbiAgICBzZXRNYXBUaXRsZSgn6KuL6YG45pOH5pel5pyf5Y2A6ZaTJylcbiAgfSlcbn0pO1xuXG5mdW5jdGlvbiBpbml0TWFwKCkge1xuICBtYXAgPSBMLm1hcCgnbWFwJykuc2V0Vmlldyhjb3VudHJ5Vmlld1tcIuWPsOWNl1wiXSwgMTQpXG5cbiAgTC50aWxlTGF5ZXIoJ2h0dHBzOi8vYXBpLm1hcGJveC5jb20vc3R5bGVzL3YxL21hcGJveC9kYXJrLXY5L3RpbGVzLzI1Ni97en0ve3h9L3t5fT9hY2Nlc3NfdG9rZW49e2FjY2Vzc1Rva2VufScsIHtcbiAgICBhdHRyaWJ1dGlvbjogJ01hcCBkYXRhICZjb3B5OyA8YSBocmVmPVwiaHR0cDovL29wZW5zdHJlZXRtYXAub3JnXCI+T3BlblN0cmVldE1hcDwvYT4gY29udHJpYnV0b3JzLCA8YSBocmVmPVwiaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvYnktc2EvMi4wL1wiPkNDLUJZLVNBPC9hPiwgSW1hZ2VyeSDCqSA8YSBocmVmPVwiaHR0cDovL21hcGJveC5jb21cIj5NYXBib3g8L2E+JyxcbiAgICBtYXhab29tOiAxOCxcbiAgICBpZDogJ2NoaW5nNTYuMTdobmc2amEnLFxuICAgIGFjY2Vzc1Rva2VuOiAncGsuZXlKMUlqb2lZMmhwYm1jMU5pSXNJbUVpT2lKamFYTmlabVl5ZEdNd01UTjFNbnB3Ym5OcU5XVnFNMnBsSW4wLms3aC1QVUdYN1RsNXhMd0RIM1Fwc2cnXG4gIH0pLmFkZFRvKG1hcCk7XG4gICQoXCIjbWFwXCIpLmhpZGUoKTtcbiAgJChcIiNtYXBcIikuZmFkZUluKCk7XG5cbiAgdmFyIHdlZWtFZ2dMZWdlbmQgPSBMLmNvbnRyb2woe1xuICAgIHBvc2l0aW9uOiAnYm90dG9tcmlnaHQnXG4gIH0pO1xuXG4gIHdlZWtFZ2dMZWdlbmQub25BZGQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGRpdiA9IEwuRG9tVXRpbC5jcmVhdGUoJ2RpdicsICdpbmZvIGxlZ2VuZCcpLFxuICAgICAgZ3JhZGVzID0gWzAsIDEsIDUwLCAxMDAsIDE1MCwgMjAwXTtcblxuICAgIGRpdi5pbm5lckhUTUwgKz0gJzxzcGFuIGNsYXNzID0gXCJsZWdlbmQtaGVhZGVyXCI+5o2V542y5pW477yI5YCL77yJPGhyPic7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBncmFkZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChncmFkZXNbaV0gPT09IDApIHtcbiAgICAgICAgZGl2LmlubmVySFRNTCArPSAnPGRpdiBjbGFzcz1cIiBiYXJyZWxfbGVnZW5kXCIgaWQ9XCJncmFkZV8nICsgaSArICdcIj4nICsgJzxpIHN0eWxlPVwiYmFja2dyb3VuZDonICsgZ2V0SWNvblN0eWxlUkdCQShncmFkZXNbaV0pICsgJ1wiPjwvaT4nICsgZ3JhZGVzW2ldICsgJzxicj48L2Rpdj4nO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGl2LmlubmVySFRNTCArPSAnPGRpdiBjbGFzcz1cIiBiYXJyZWxfbGVnZW5kXCIgaWQ9XCJncmFkZV8nICsgaSArICdcIj4nICsgJzxpIHN0eWxlPVwiYmFja2dyb3VuZDonICsgZ2V0SWNvblN0eWxlUkdCQShncmFkZXNbaV0pICsgJ1wiPjwvaT4nICsgZ3JhZGVzW2ldICsgKGdyYWRlc1tpICsgMV0gPyAnICZuZGFzaDsgJyArIChncmFkZXNbaSArIDFdIC0gMSkgKyAnPGJyPjwvZGl2PicgOiAnIDxicj48L2Rpdj4nKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBkaXYuaW5uZXJIVE1MICs9ICc8ZGl2IGNsYXNzPVwiIGJhcnJlbF9sZWdlbmRcIiBpZD1cImdyYWRlX290aGVyXCI+JyArICc8aSBzdHlsZT1cImJhY2tncm91bmQ6I2NjY2NjY1wiPjwvaT4nICsgJ+eEoeizh+aWmScgKyAnPGJyPjwvZGl2Pic7XG5cbiAgICByZXR1cm4gZGl2O1xuICB9O1xuXG4gIHdlZWtFZ2dMZWdlbmQuYWRkVG8obWFwKTtcbiAgJChcIi5iYXJyZWxfbGVnZW5kID4gaW5wdXRcIikub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHNlbGVjdGVkQ2xhc3MgPSAnLicgKyAkKHRoaXMpLnZhbCgpXG4gICAgaWYgKCQodGhpcykucHJvcChcImNoZWNrZWRcIikpIHtcbiAgICAgICQoc2VsZWN0ZWRDbGFzcykuY3NzKCdkaXNwbGF5JywgJ2Jsb2NrJylcbiAgICB9IGVsc2Uge1xuICAgICAgJChzZWxlY3RlZENsYXNzKS5jc3MoJ2Rpc3BsYXknLCAnbm9uZScpXG4gICAgfVxuICB9KVxufVxuXG5mdW5jdGlvbiBkYXRlcGlja2VyT25DaGFuZ2UoKSB7XG4gIGxldCBhdmFpbGFibGVEYXRlc0luSW50ZXJ2YWwgPSBbXVxuICBsZXQgZGF0YUluSW50ZXJ2YWwgPSB7fVxuICBjb25zdCBzdGFydERhdGUgPSBtb21lbnQoJCgnLnJhbmdlLXN0YXJ0JykudmFsKCkpXG4gIGNvbnN0IGVuZERhdGUgPSBtb21lbnQoJCgnLnJhbmdlLWVuZCcpLnZhbCgpKVxuICBjb25zb2xlLmxvZygndHJpZ2dlciBjaGFuZ2UnKVxuXG4gIGlmKCBzdGFydERhdGU9PT0nJyB8fCBlbmREYXRlID09PSAnJylcbiAgICByZXR1cm5cblxuICBhdmFpbGFibGVEYXRlcy5mb3JFYWNoKChkKSA9PiB7XG4gICAgbGV0IHRoaXNEYXkgPSBtb21lbnQoZClcbiAgICBpZiAodGhpc0RheSA+PSBzdGFydERhdGUgJiYgdGhpc0RheSA8PSBlbmREYXRlKSB7XG4gICAgICBhdmFpbGFibGVEYXRlc0luSW50ZXJ2YWwucHVzaCh0aGlzRGF5KVxuICAgIH1cbiAgfSlcblxuICBhdmFpbGFibGVEYXRlc0luSW50ZXJ2YWwuZm9yRWFjaCgoZCkgPT4ge1xuICAgIGxldCB0aGlzRGF5S2V5ID0gZC5mb3JtYXQoJ1lZWVktTU0tREQnKVxuICAgIGRhdGFJbkludGVydmFsW3RoaXNEYXlLZXldID0gZ2V0Q291bnQodGhpc0RheUtleSlcbiAgfSlcblxuICBcblxuICBpbnNlcnRCdWNrZXRMaXN0KGRhdGFJbkludGVydmFsKTtcbiAgcmVuZGVyRXZlbnQoKVxufVxuXG5mdW5jdGlvbiBpbnNlcnRCdWNrZXRMaXN0KGRhdGVEYXRhTWFwKSB7XG4gIGNvbnN0IGhhc1N0YXJ0RGF0ZSA9ICEoJCgnLnJhbmdlLXN0YXJ0JykudmFsKCkgPT09ICcnKVxuICBjb25zdCBoYXNFbmREYXRlID0gISgkKCcucmFuZ2UtZW5kJykudmFsKCkgPT09ICcnKVxuICBjb25zdCBzdGFydERhdGUgPSBoYXNTdGFydERhdGUgPyBtb21lbnQoJCgnLnJhbmdlLXN0YXJ0JykudmFsKCkpLmZvcm1hdCgnWVlZWS1NTS1ERCcpIDogJ+acqumBuOaTh+i1t+Wni+aXpeacnydcbiAgY29uc3QgZW5kRGF0ZSA9IGhhc0VuZERhdGUgPyBtb21lbnQoJCgnLnJhbmdlLWVuZCcpLnZhbCgpKS5mb3JtYXQoJ1lZWVktTU0tREQnKSA6ICfmnKrpgbjmk4fntZDmnZ/ml6XmnJ8nXG4gICQoXCIubWFwLWNvbnRhaW5lciAubGlzdC1ncm91cFwiKS5lbXB0eSgpO1xuICBjbGVhck1hcCgpO1xuXG4gIGlmIChnZXRLZXlzKGRhdGVEYXRhTWFwKS5sZW5ndGggPT09IDApIHtcbiAgICBsZXQgaW5mbyA9ICfmspLmnInos4fmlpknXG4gICAgaWYgKCFoYXNFbmREYXRlIHx8ICFoYXNTdGFydERhdGUpIHtcbiAgICAgIGluZm8gPSAnJ1xuICAgIH1cbiAgICBzZXRNYXBUaXRsZShgJHtzdGFydERhdGV9IH4gJHtlbmREYXRlfSAke2luZm99YClcbiAgfSBlbHNlIHtcbiAgICBzZXRNYXBUaXRsZShgJHtzdGFydERhdGV9IH4gJHtlbmREYXRlfSDljYDplpPos4fmlplgKVxuICB9XG5cbiAgZm9yIChsZXQgZGF0ZSBpbiBkYXRlRGF0YU1hcCkge1xuICAgIGxldCB0aGlzRGF5Q291bnREYXRhID0gZGF0ZURhdGFNYXBbZGF0ZV1cbiAgICBmb3IgKGxldCBpZCBpbiB0aGlzRGF5Q291bnREYXRhKSB7XG4gICAgICBjb25zdCBjb3VudCA9IHRoaXNEYXlDb3VudERhdGFbaWRdXG4gICAgICBjb25zdCBsYW1wID0gYnVja2V0SnNvbi5maW5kKChkKSA9PiB7XG4gICAgICAgIHJldHVybiBkLmxhbXBfaWQgPT09IGlkXG4gICAgICB9KVxuICAgICAgY29uc3QgcGxhY2UgPSBnZXRQbGFjZU5hbWUobGFtcC5wbGFjZV9pZClcbiAgICAgIGluc2VydEJ1Y2tldEh0bWwocGxhY2UsIGxhbXAsIGNvdW50KTtcbiAgICAgIGJpbmRQb3B1cHMobGFtcCwgY291bnQpO1xuICAgIH1cbiAgfVxuXG4gICQoJyNtYXAnKS5mYWRlSW4oKVxufVxuXG5mdW5jdGlvbiBpbnNlcnRCdWNrZXRIdG1sKGluZm8sIGJ1Y2tldCwgY291bnQpIHtcbiAgdmFyIGluc2VydEhUTUwgPSBgPGEgY2xhc3M9XCJsaXN0LWdyb3VwLWl0ZW0gXCI+XG4gICAgICAgIDxoNCBjbGFzcz1cImxpc3QtZ3JvdXAtaXRlbS1oZWFkaW5nXCI+PHNwYW4+JHtidWNrZXQubGFtcF9pZH1AJHtpbmZvfTwvc3Bhbj48c3Bhbj4mIzk4ODk7JHtjb3VudH08L3NwYW4+PC9oND5cbiAgICAgICAgPHAgY2xhc3M9XCJsaXN0LWdyb3VwLWl0ZW0tdGV4dFwiPiAke21vbWVudC50eihidWNrZXQudXBkYXRlZF9hdCwgJ0FzaWEvVGFpcGVpJykuZm9ybWF0KCdMTEwnKX08L3A+XG4gICAgICA8L2E+YFxuICAkKFwiLm1hcC1jb250YWluZXIgLmxpc3QtZ3JvdXBcIikuYXBwZW5kKGluc2VydEhUTUwpO1xufVxuXG5mdW5jdGlvbiBnZXRLZXlzKG9iaikge1xuICB0cnkge1xuICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqKTtcbiAgICByZXR1cm4ga2V5cztcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgcmV0dXJuIFtdO1xuICB9XG59XG5cbmZ1bmN0aW9uIHNldE1hcFRpdGxlKG1hcFRpdGxlKSB7XG4gIC8vIGNsZWFyIGxvYWRpbmcgdGV4dCBcbiAgY29uc29sZS5sb2coJ3NldCB0aXRsZScsIG1hcFRpdGxlKVxuICBjb25zdCB0aXRsZSA9ICQoYDxoMz4ke21hcFRpdGxlfTwvaDM+YClcbiAgJCgnLmxpc3QtZ3JvdXAnKS5lbXB0eSgpXG4gICQoJy5saXN0LWdyb3VwJykuYXBwZW5kKHRpdGxlKVxuICBcbiAgdGl0bGUuaGlkZSgpO1xuICB0aXRsZS5mYWRlSW4oJ3Nsb3cnKTtcbn1cblxuZnVuY3Rpb24gcmVuZGVyRXZlbnQoZGF0ZSkge1xuICBldmVudEpzb24uZm9yRWFjaChmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICB2YXIgbGF0bG5nID0gW2V2ZW50Lm1jY19jZW50ZXJbMV0sIGV2ZW50Lm1jY19jZW50ZXJbMF1dXG4gICAgdmFyIHJhZGl1cyA9IG1jY0Rpc3RhbmNlTG93ZXJMaW1pdFxuICAgIHZhciBjaXJjbGUgPSBMLmNpcmNsZShsYXRsbmcsIHtcbiAgICAgIHJhZGl1czogcmFkaXVzXG4gICAgfSlcbiAgICBjaXJjbGVzLnB1c2goY2lyY2xlKVxuICAgIGNpcmNsZS5hZGRUbyhtYXApO1xuICB9KVxufVxuXG5mdW5jdGlvbiBjbGVhck1hcCgpIHtcbiAgbWFya2VyQXJyYXkuZm9yRWFjaChmdW5jdGlvbiAobWFya2VyKSB7XG4gICAgbWFwLnJlbW92ZUxheWVyKG1hcmtlcik7XG4gIH0pO1xuXG4gIGNpcmNsZXMuZm9yRWFjaChmdW5jdGlvbiAoY2lyY2xlKSB7XG4gICAgY2lyY2xlLnJlbW92ZSgpXG4gIH0pXG5cbiAgY2lyY2xlcyA9IFtdXG5cbiAgJChcIiNtYXBcIikuaGlkZSgpO1xufVxuXG5mdW5jdGlvbiBiaW5kUG9wdXBzKGxhbXAsIGNvdW50KSB7XG5cbiAgdmFyIFNDQUxFID0gODA7XG5cblxuICB2YXIgbGF0ID0gbGFtcC5sYW1wX2xvY2F0aW9uWzFdXG4gIHZhciBsbmcgPSBsYW1wLmxhbXBfbG9jYXRpb25bMF1cblxuICB2YXIgaWNvbiA9IEwuaWNvbih7XG4gICAgaWNvblVybDogZ2V0SWNvblN0eWxlKGNvdW50KSxcbiAgICBpY29uU2l6ZTogWzQ1LCA4MF0sIC8vIHNpemUgb2YgdGhlIGljb25cbiAgICBwb3B1cEFuY2hvcjogWzAsIC00MF0sXG4gICAgaWNvbkFuY2hvcjogWzIyLCA2MF0sXG4gICAgY2xhc3NOYW1lOiBnZXRJY29uQ2F0KGNvdW50KSxcbiAgfSk7XG5cbiAgdmFyIFBvcFVwQ29udGVudCA9ICgnPHRhYmxlPicgK1xuICAgICc8dHI+JyArXG4gICAgJzx0aD4gSUQgPC90aD4nICtcbiAgICAnPHRkPiB7MH0gPC90ZD4nICtcbiAgICAnPC90cj4nICtcbiAgICAnPHRyPicgK1xuICAgICc8dGg+5Zyw6buePC90aD4nICtcbiAgICAnPHRkPnsxfTwvdGQ+JyArXG4gICAgJzwvdHI+JyArXG4gICAgJzx0cj4nICtcbiAgICAnPHRoPuaNleeNsjwvdGg+JyArXG4gICAgJzx0ZD57Mn08L3RkPicgK1xuICAgICc8L3RyPicgK1xuICAgICc8L3RhYmxlPicpLmZvcm1hdChsYW1wLmxhbXBfaWQsIGdldFBsYWNlTmFtZShsYW1wLnBsYWNlX2lkKSwgY291bnQpXG5cbiAgdmFyIG1hcmtlciA9IEwubWFya2VyKFtsYXQsIGxuZ10sIHtcbiAgICAgIGljb246IGljb25cbiAgICB9KVxuICAgIC5iaW5kUG9wdXAoUG9wVXBDb250ZW50KS5hZGRUbyhtYXApO1xuICBtYXJrZXJBcnJheS5wdXNoKG1hcmtlcik7XG59XG5cbmZ1bmN0aW9uIGdldEljb25TdHlsZShhbW91bnQpIHtcbiAgdmFyIHN0eWxlO1xuICBpZiAoYW1vdW50ID09PSAwKSB7XG4gICAgc3R5bGUgPSAnbGVnZW5kMSc7XG4gIH0gZWxzZSBpZiAoYW1vdW50ID4gMCAmJiBhbW91bnQgPD0gNDkpIHtcbiAgICBzdHlsZSA9ICdsZWdlbmQyJztcbiAgfSBlbHNlIGlmIChhbW91bnQgPj0gNTAgJiYgYW1vdW50IDw9IDk5KSB7XG4gICAgc3R5bGUgPSAnbGVnZW5kMyc7XG4gIH0gZWxzZSBpZiAoYW1vdW50ID49IDEwMCAmJiBhbW91bnQgPD0gMTQ5KSB7XG4gICAgc3R5bGUgPSAnbGVnZW5kNCc7XG4gIH0gZWxzZSBpZiAoYW1vdW50ID49IDE1MCAmJiBhbW91bnQgPD0gMTk5KSB7XG4gICAgc3R5bGUgPSAnbGVnZW5kNSc7XG4gIH0gZWxzZSBpZiAoYW1vdW50ID49IDIwMCkge1xuICAgIHN0eWxlID0gJ2xlZ2VuZDYnO1xuICB9IGVsc2Uge1xuICAgIHN0eWxlID0gJ2xlZ2VuZF91bmRlZmluZWQnO1xuICB9XG4gIHJldHVybiAnaW1hZ2VzLycgKyBzdHlsZSArICcuc3ZnJztcbn1cblxuZnVuY3Rpb24gZ2V0SWNvbkNhdChhbW91bnQpIHtcbiAgdmFyIGNhdGVnb3J5O1xuICBpZiAoYW1vdW50ID09PSAwKSB7XG4gICAgY2F0ZWdvcnkgPSAnZ3JhZGVfMCc7XG4gIH0gZWxzZSBpZiAoYW1vdW50ID4gMCAmJiBhbW91bnQgPD0gNDkpIHtcbiAgICBjYXRlZ29yeSA9ICdncmFkZV8xJztcbiAgfSBlbHNlIGlmIChhbW91bnQgPj0gNTAgJiYgYW1vdW50IDw9IDk5KSB7XG4gICAgY2F0ZWdvcnkgPSAnZ3JhZGVfMic7XG4gIH0gZWxzZSBpZiAoYW1vdW50ID49IDEwMCAmJiBhbW91bnQgPD0gMTQ5KSB7XG4gICAgY2F0ZWdvcnkgPSAnZ3JhZGVfMyc7XG4gIH0gZWxzZSBpZiAoYW1vdW50ID49IDE1MCAmJiBhbW91bnQgPD0gMTk5KSB7XG4gICAgY2F0ZWdvcnkgPSAnZ3JhZGVfNCc7XG4gIH0gZWxzZSBpZiAoYW1vdW50ID49IDIwMCkge1xuICAgIGNhdGVnb3J5ID0gJ2dyYWRlXzUnO1xuICB9IGVsc2Uge1xuICAgIGNhdGVnb3J5ID0gJ2dyYWRlX290aGVyJztcbiAgfVxuICByZXR1cm4gY2F0ZWdvcnk7XG59XG5cbmZ1bmN0aW9uIGdldEljb25TdHlsZVJHQkEoYW1vdW50KSB7XG4gIHZhciBzdHlsZTtcbiAgaWYgKGFtb3VudCA9PT0gMCkge1xuICAgIHN0eWxlID0gJyMwMEZGOUQnO1xuICB9IGVsc2UgaWYgKGFtb3VudCA+IDAgJiYgYW1vdW50IDw9IDQ5KSB7XG4gICAgc3R5bGUgPSAnIzMzQ0M3RSc7XG4gIH0gZWxzZSBpZiAoYW1vdW50ID49IDUwICYmIGFtb3VudCA8PSA5OSkge1xuICAgIHN0eWxlID0gJyM2Njk5NUUnO1xuICB9IGVsc2UgaWYgKGFtb3VudCA+PSAxMDAgJiYgYW1vdW50IDw9IDE0OSkge1xuICAgIHN0eWxlID0gJyM5OTY2M0YnO1xuICB9IGVsc2UgaWYgKGFtb3VudCA+PSAxNTAgJiYgYW1vdW50IDw9IDE5OSkge1xuICAgIHN0eWxlID0gJyNDQzMzMUYnO1xuICB9IGVsc2UgaWYgKGFtb3VudCA+PSAyMDApIHtcbiAgICBzdHlsZSA9ICcjRkYwMDAwJztcbiAgfVxuXG4gIHJldHVybiBzdHlsZTtcbn0iXX0=\n"]}