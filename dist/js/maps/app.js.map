{"version":3,"sources":["app.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","initMap","map","L","setView","countryView","tileLayer","attribution","maxZoom","id","accessToken","addTo","$","hide","fadeIn","weekEggLegend","control","position","onAdd","div","DomUtil","create","grades","innerHTML","getIconStyleRGBA","datepickerOnChange","dataInInterval","startDate","moment","val","endDate","events","eventJson","slice","filter","d","eventDate","tz","created_at","availableDates","forEach","thisDay","thisDayKey","format","getCount","insertBucketList","renderEvent","dateDataMap","hasStartDate","hasEndDate","lampSumData","empty","clearMap","getKeys","info","setMapTitle","date","thisDayCountData","count","lamp","bucketJson","find","lamp_id","insertBucketHtml","getPlaceName","place_id","lampCount","_loop","bindPopups","bucket","insertHTML","append","obj","Object","keys","err","mapTitle","title","event","latlng","mcc_center","radius","mccDistanceLowerLimit","circle","circles","push","markerArray","marker","removeLayer","remove","_lamp","lat","lamp_location","lng","icon","iconUrl","getIconStyle","iconSize","popupAnchor","iconAnchor","className","getIconCat","PopUpContent","bindPopup","group","featureGroup","fitBounds","getBounds","amount","style","_slicedToArray","sliceIterator","arr","_arr","_n","_d","_e","undefined","_s","_i","Symbol","iterator","next","done","value","Array","isArray","TypeError","countJson","placeJson","台南","高雄","屏東","getPlaceNameFunc","placeMap","place_name","getCountFunc","countMap","dateData","sum","locale","document","ready","datepicker","autoclose","zIndexOffset","disableTouchKeyboard","on","reqPromises","url","ajax","dataType","type","Promise","all","then","res","console","log","rule","_res","distance_lower_limit","catch","status","statusText"],"mappings":"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","file":"../app.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar bucketJson = [];\nvar eventJson = [];\nvar countJson = [];\nvar placeJson = [];\nvar mccDistanceLowerLimit = void 0;\nvar map = void 0;\nvar markerArray = [];\nvar circles = [];\nvar getPlaceName = void 0;\nvar getCount = void 0;\nvar availableDates = void 0;\n\nvar countryView = {\n  '台南': [22.9971, 120.1926],\n  '高雄': [22.6397615, 120.2999183],\n  '屏東': [22.667431, 120.486307]\n};\n\nvar getPlaceNameFunc = function getPlaceNameFunc(placeJson) {\n  var placeMap = {};\n  placeJson.forEach(function (d) {\n    placeMap[d.place_id] = d.place_name;\n  });\n  return function (id) {\n    return placeMap[id];\n  };\n};\n\nvar getCountFunc = function getCountFunc(countJson) {\n  var countMap = {};\n  availableDates.forEach(function (d) {\n    countMap[d] = {};\n  });\n  for (var i in countJson) {\n    var dateData = countJson[i];\n    for (var id in dateData) {\n      countMap[i][id] = +dateData[id].sum;\n    }\n  }\n  return function (date) {\n    return countMap[date];\n  };\n};\n\nmoment.locale('zh-tw');\n\n$(document).ready(function () {\n  setMapTitle('資料載入中...');\n\n  $('.range-start, .range-end').datepicker({\n    'autoclose': true,\n    'zIndexOffset': 1000,\n    'format': 'yyyy-mm-dd',\n    'disableTouchKeyboard': true\n  }).on('changeDate', datepickerOnChange);\n\n  var root_url = 'http://140.116.249.228:3000/apis/';\n  var urls = ['lamps', 'rules', 'mcc', 'counts?formatBy=date', 'places'];\n\n  var reqPromises = urls.map(function (url) {\n    return $.ajax({\n      url: root_url + url,\n      dataType: \"JSON\",\n      type: \"GET\"\n    });\n  });\n\n  Promise.all(reqPromises).then(function (res) {\n    console.log(res);\n    var rule = void 0;\n\n    var _res = _slicedToArray(res, 5);\n\n    bucketJson = _res[0];\n    rule = _res[1];\n    eventJson = _res[2];\n    countJson = _res[3];\n    placeJson = _res[4];\n\n\n    mccDistanceLowerLimit = rule[0].distance_lower_limit;\n\n    availableDates = getKeys(countJson);\n    getPlaceName = getPlaceNameFunc(placeJson);\n    getCount = getCountFunc(countJson);\n\n    initMap();\n    setMapTitle('請選擇日期區間');\n  }).catch(function (err) {\n    console.log(err);\n    setMapTitle('\\u8CC7\\u6599\\u932F\\u8AA4\\uFF1A' + err.status + ' ' + err.statusText);\n  });\n});\n\nfunction initMap() {\n  map = L.map('map').setView(countryView[\"台南\"], 14);\n\n  L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/dark-v9/tiles/256/{z}/{x}/{y}?access_token={accessToken}', {\n    attribution: 'Map data &copy; <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, Imagery © <a href=\"http://mapbox.com\">Mapbox</a>',\n    maxZoom: 18,\n    id: 'ching56.17hng6ja',\n    accessToken: 'pk.eyJ1IjoiY2hpbmc1NiIsImEiOiJjaXNiZmYydGMwMTN1MnpwbnNqNWVqM2plIn0.k7h-PUGX7Tl5xLwDH3Qpsg'\n  }).addTo(map);\n  $(\"#map\").hide();\n  $(\"#map\").fadeIn();\n\n  var weekEggLegend = L.control({\n    position: 'bottomright'\n  });\n\n  weekEggLegend.onAdd = function () {\n    var div = L.DomUtil.create('div', 'info legend'),\n        grades = [0, 1, 50, 100, 150, 200];\n\n    div.innerHTML += '<span class = \"legend-header\">捕獲數（個）<hr>';\n    for (var i = 0; i < grades.length; i++) {\n      if (grades[i] === 0) {\n        div.innerHTML += '<div class=\" barrel_legend\" id=\"grade_' + i + '\">' + '<i style=\"background:' + getIconStyleRGBA(grades[i]) + '\"></i>' + grades[i] + '<br></div>';\n      } else {\n        div.innerHTML += '<div class=\" barrel_legend\" id=\"grade_' + i + '\">' + '<i style=\"background:' + getIconStyleRGBA(grades[i]) + '\"></i>' + grades[i] + (grades[i + 1] ? ' &ndash; ' + (grades[i + 1] - 1) + '<br></div>' : ' <br></div>');\n      }\n    }\n\n    div.innerHTML += '<div class=\" barrel_legend\" id=\"grade_other\">' + '<i style=\"background:#cccccc\"></i>' + '無資料' + '<br></div>';\n\n    return div;\n  };\n\n  weekEggLegend.addTo(map);\n}\n\nfunction datepickerOnChange() {\n  var dataInInterval = {};\n  var startDate = moment($('.range-start').val());\n  var endDate = moment($('.range-end').val());\n  var events = eventJson.slice().filter(function (d) {\n    var eventDate = moment.tz(d.created_at, 'Asia/Taipei');\n    return eventDate <= endDate && eventDate >= startDate;\n  });\n\n  if (startDate === '' || endDate === '') return;\n\n  availableDates.forEach(function (d) {\n    var thisDay = moment(d);\n    if (thisDay >= startDate && thisDay <= endDate) {\n      var thisDayKey = thisDay.format('YYYY-MM-DD');\n      dataInInterval[thisDayKey] = getCount(thisDayKey);\n    }\n  });\n\n  insertBucketList(dataInInterval);\n  renderEvent(events);\n}\n\nfunction insertBucketList(dateDataMap) {\n  var hasStartDate = !($('.range-start').val() === '');\n  var hasEndDate = !($('.range-end').val() === '');\n  var startDate = hasStartDate ? moment($('.range-start').val()).format('YYYY-MM-DD') : '未選擇起始日期';\n  var endDate = hasEndDate ? moment($('.range-end').val()).format('YYYY-MM-DD') : '未選擇結束日期';\n  var lampSumData = {};\n  $(\".map-container .list-group\").empty();\n  clearMap();\n\n  if (getKeys(dateDataMap).length === 0) {\n    var info = '沒有資料';\n    if (!hasEndDate || !hasStartDate) {\n      info = '';\n    }\n    setMapTitle(startDate + ' ~ ' + endDate + ' ' + info);\n  } else {\n    setMapTitle(startDate + ' ~ ' + endDate + ' \\u5340\\u9593\\u8CC7\\u6599');\n  }\n\n  for (var date in dateDataMap) {\n    var thisDayCountData = dateDataMap[date];\n\n    var _loop = function _loop(id) {\n      var count = thisDayCountData[id];\n      var lamp = bucketJson.find(function (d) {\n        return d.lamp_id === id;\n      });\n      var place = getPlaceName(lamp.place_id);\n      insertBucketHtml(place, lamp, count, date);\n      if (!lampSumData[lamp.lamp_id]) {\n        lampSumData[lamp.lamp_id] = {};\n        lampSumData[lamp.lamp_id].lamp = lamp;\n        lampSumData[lamp.lamp_id].count = 0;\n      }\n      var lampCount = lampSumData[lamp.lamp_id].count;\n      lampSumData[lamp.lamp_id].count = lampCount + count;\n    };\n\n    for (var id in thisDayCountData) {\n      _loop(id);\n    }\n  }\n  bindPopups(lampSumData);\n  $('#map').fadeIn();\n}\n\nfunction insertBucketHtml(info, bucket, count, date) {\n  var insertHTML = '<a class=\"list-group-item \">\\n        <h4 class=\"list-group-item-heading\"><span>' + bucket.lamp_id + '@' + info + '</span><span>&#9889;' + count + '</span></h4>\\n        <p class=\"list-group-item-text\"> ' + moment(date).format('LL') + '</p>\\n      </a>';\n  $(\".map-container .list-group\").append(insertHTML);\n}\n\nfunction getKeys(obj) {\n  try {\n    var keys = Object.keys(obj);\n    return keys;\n  } catch (err) {\n    return [];\n  }\n}\n\nfunction setMapTitle(mapTitle) {\n  // clear loading text \n  var title = $('<h3>' + mapTitle + '</h3>');\n  $('.list-group').empty();\n  $('.list-group').append(title);\n\n  title.hide();\n  title.fadeIn('slow');\n}\n\nfunction renderEvent(events) {\n  events.forEach(function (event) {\n    var latlng = [event.mcc_center[1], event.mcc_center[0]];\n    var radius = mccDistanceLowerLimit;\n    var circle = L.circle(latlng, {\n      radius: radius\n    });\n    circles.push(circle);\n    circle.addTo(map);\n  });\n}\n\nfunction clearMap() {\n  markerArray.forEach(function (marker) {\n    map.removeLayer(marker);\n  });\n\n  circles.forEach(function (circle) {\n    circle.remove();\n  });\n\n  circles = [];\n\n  $(\"#map\").hide();\n}\n\nfunction bindPopups(lampSumData) {\n\n  var SCALE = 80;\n\n  for (var id in lampSumData) {\n    var _lamp = lampSumData[id].lamp;\n    var count = lampSumData[id].count;\n    var lat = _lamp.lamp_location[1];\n    var lng = _lamp.lamp_location[0];\n    var icon = L.icon({\n      iconUrl: getIconStyle(count),\n      iconSize: [45, 80], // size of the icon\n      popupAnchor: [0, -40],\n      iconAnchor: [22, 60],\n      className: getIconCat(count)\n    });\n    var PopUpContent = '<table>\\n      <tr>\\n        <th> ID </th>\\n        <td> ' + _lamp.lamp_id + ' </td>\\n      </tr>\\n      <tr>\\n        <th>\\u5730\\u9EDE</th>\\n        <td>' + getPlaceName(_lamp.place_id) + '</td>\\n      </tr>\\n        <tr>\\n        <th>\\u6355\\u7372</th>\\n        <td>' + count + '</td>\\n      </tr>\\n      </table>';\n    var marker = L.marker([lat, lng], {\n      icon: icon\n    }).bindPopup(PopUpContent).addTo(map);\n    markerArray.push(marker);\n  }\n  if (markerArray.length > 0) {\n    var group = new L.featureGroup(markerArray);\n    map.fitBounds(group.getBounds());\n  }\n}\n\nfunction getIconStyle(amount) {\n  var style = void 0;\n  if (amount === 0) {\n    style = 'legend1';\n  } else if (amount > 0 && amount <= 49) {\n    style = 'legend2';\n  } else if (amount >= 50 && amount <= 99) {\n    style = 'legend3';\n  } else if (amount >= 100 && amount <= 149) {\n    style = 'legend4';\n  } else if (amount >= 150 && amount <= 199) {\n    style = 'legend5';\n  } else if (amount >= 200) {\n    style = 'legend6';\n  } else {\n    style = 'legend_undefined';\n  }\n  return 'images/' + style + '.svg';\n}\n\nfunction getIconCat(amount) {\n  var category = void 0;\n  if (amount === 0) {\n    category = 'grade_0';\n  } else if (amount > 0 && amount <= 49) {\n    category = 'grade_1';\n  } else if (amount >= 50 && amount <= 99) {\n    category = 'grade_2';\n  } else if (amount >= 100 && amount <= 149) {\n    category = 'grade_3';\n  } else if (amount >= 150 && amount <= 199) {\n    category = 'grade_4';\n  } else if (amount >= 200) {\n    category = 'grade_5';\n  } else {\n    category = 'grade_other';\n  }\n  return category;\n}\n\nfunction getIconStyleRGBA(amount) {\n  var style = void 0;\n  if (amount === 0) {\n    style = '#00FF9D';\n  } else if (amount > 0 && amount <= 49) {\n    style = '#33CC7E';\n  } else if (amount >= 50 && amount <= 99) {\n    style = '#66995E';\n  } else if (amount >= 100 && amount <= 149) {\n    style = '#99663F';\n  } else if (amount >= 150 && amount <= 199) {\n    style = '#CC331F';\n  } else if (amount >= 200) {\n    style = '#FF0000';\n  }\n\n  return style;\n}\n\n},{}]},{},[1])\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYXBwLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7OztBQ0FBLElBQUksYUFBYSxFQUFqQjtBQUNBLElBQUksWUFBWSxFQUFoQjtBQUNBLElBQUksWUFBWSxFQUFoQjtBQUNBLElBQUksWUFBWSxFQUFoQjtBQUNBLElBQUksOEJBQUo7QUFDQSxJQUFJLFlBQUo7QUFDQSxJQUFJLGNBQWMsRUFBbEI7QUFDQSxJQUFJLFVBQVUsRUFBZDtBQUNBLElBQUkscUJBQUo7QUFDQSxJQUFJLGlCQUFKO0FBQ0EsSUFBSSx1QkFBSjs7QUFFQSxJQUFNLGNBQWM7QUFDbEIsUUFBTSxDQUFDLE9BQUQsRUFBVSxRQUFWLENBRFk7QUFFbEIsUUFBTSxDQUFDLFVBQUQsRUFBYSxXQUFiLENBRlk7QUFHbEIsUUFBTSxDQUFDLFNBQUQsRUFBWSxVQUFaO0FBSFksQ0FBcEI7O0FBTUEsSUFBSSxtQkFBbUIsU0FBbkIsZ0JBQW1CLENBQVUsU0FBVixFQUFxQjtBQUMxQyxNQUFJLFdBQVcsRUFBZjtBQUNBLFlBQVUsT0FBVixDQUFrQixVQUFVLENBQVYsRUFBYTtBQUM3QixhQUFTLEVBQUUsUUFBWCxJQUF1QixFQUFFLFVBQXpCO0FBQ0QsR0FGRDtBQUdBLFNBQU8sVUFBVSxFQUFWLEVBQWM7QUFDbkIsV0FBTyxTQUFTLEVBQVQsQ0FBUDtBQUNELEdBRkQ7QUFHRCxDQVJEOztBQVVBLElBQUksZUFBZSxTQUFmLFlBQWUsQ0FBQyxTQUFELEVBQWU7QUFDaEMsTUFBSSxXQUFXLEVBQWY7QUFDQSxpQkFBZSxPQUFmLENBQXVCLFVBQUMsQ0FBRCxFQUFPO0FBQzVCLGFBQVMsQ0FBVCxJQUFjLEVBQWQ7QUFDRCxHQUZEO0FBR0EsT0FBSyxJQUFJLENBQVQsSUFBYyxTQUFkLEVBQXlCO0FBQ3ZCLFFBQUksV0FBVyxVQUFVLENBQVYsQ0FBZjtBQUNBLFNB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WUFBUSxTQUFSO0FBQ0QsR0FGTSxNQUVBLElBQUksVUFBVSxFQUFWLElBQWdCLFVBQVUsRUFBOUIsRUFBa0M7QUFDdkMsWUFBUSxTQUFSO0FBQ0QsR0FGTSxNQUVBLElBQUksVUFBVSxHQUFWLElBQWlCLFVBQVUsR0FBL0IsRUFBb0M7QUFDekMsWUFBUSxTQUFSO0FBQ0QsR0FGTSxNQUVBLElBQUksVUFBVSxHQUFWLElBQWlCLFVBQVUsR0FBL0IsRUFBb0M7QUFDekMsWUFBUSxTQUFSO0FBQ0QsR0FGTSxNQUVBLElBQUksVUFBVSxHQUFkLEVBQW1CO0FBQ3hCLFlBQVEsU0FBUjtBQUNEOztBQUVELFNBQU8sS0FBUDtBQUNEIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsImxldCBidWNrZXRKc29uID0gW11cbmxldCBldmVudEpzb24gPSBbXVxubGV0IGNvdW50SnNvbiA9IFtdXG5sZXQgcGxhY2VKc29uID0gW11cbmxldCBtY2NEaXN0YW5jZUxvd2VyTGltaXRcbmxldCBtYXA7XG5sZXQgbWFya2VyQXJyYXkgPSBbXTtcbmxldCBjaXJjbGVzID0gW11cbmxldCBnZXRQbGFjZU5hbWVcbmxldCBnZXRDb3VudFxubGV0IGF2YWlsYWJsZURhdGVzXG5cbmNvbnN0IGNvdW50cnlWaWV3ID0ge1xuICAn5Y+w5Y2XJzogWzIyLjk5NzEsIDEyMC4xOTI2XSxcbiAgJ+mrmOmbhCc6IFsyMi42Mzk3NjE1LCAxMjAuMjk5OTE4M10sXG4gICflsY/mnbEnOiBbMjIuNjY3NDMxLCAxMjAuNDg2MzA3XVxufVxuXG5sZXQgZ2V0UGxhY2VOYW1lRnVuYyA9IGZ1bmN0aW9uIChwbGFjZUpzb24pIHtcbiAgbGV0IHBsYWNlTWFwID0ge31cbiAgcGxhY2VKc29uLmZvckVhY2goZnVuY3Rpb24gKGQpIHtcbiAgICBwbGFjZU1hcFtkLnBsYWNlX2lkXSA9IGQucGxhY2VfbmFtZVxuICB9KVxuICByZXR1cm4gZnVuY3Rpb24gKGlkKSB7XG4gICAgcmV0dXJuIHBsYWNlTWFwW2lkXVxuICB9XG59XG5cbmxldCBnZXRDb3VudEZ1bmMgPSAoY291bnRKc29uKSA9PiB7XG4gIGxldCBjb3VudE1hcCA9IHt9XG4gIGF2YWlsYWJsZURhdGVzLmZvckVhY2goKGQpID0+IHtcbiAgICBjb3VudE1hcFtkXSA9IHt9XG4gIH0pXG4gIGZvciAobGV0IGkgaW4gY291bnRKc29uKSB7XG4gICAgbGV0IGRhdGVEYXRhID0gY291bnRKc29uW2ldXG4gICAgZm9yIChsZXQgaWQgaW4gZGF0ZURhdGEpXG4gICAgICBjb3VudE1hcFtpXVtpZF0gPSArZGF0ZURhdGFbaWRdLnN1bVxuICB9XG4gIHJldHVybiAoZGF0ZSkgPT4ge1xuICAgIHJldHVybiBjb3VudE1hcFtkYXRlXVxuICB9XG59XG5cbm1vbWVudC5sb2NhbGUoJ3poLXR3JylcblxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuICBzZXRNYXBUaXRsZSgn6LOH5paZ6LyJ5YWl5LitLi4uJylcblxuICAkKCcucmFuZ2Utc3RhcnQsIC5yYW5nZS1lbmQnKS5kYXRlcGlja2VyKHtcbiAgICAnYXV0b2Nsb3NlJzogdHJ1ZSxcbiAgICAnekluZGV4T2Zmc2V0JzogMTAwMCxcbiAgICAnZm9ybWF0JzogJ3l5eXktbW0tZGQnLFxuICAgICdkaXNhYmxlVG91Y2hLZXlib2FyZCc6IHRydWVcbiAgfSkub24oJ2NoYW5nZURhdGUnLCBkYXRlcGlja2VyT25DaGFuZ2UpXG5cbiAgY29uc3Qgcm9vdF91cmwgPSAnaHR0cDovLzE0MC4xMTYuMjQ5LjIyODozMDAwL2FwaXMvJ1xuICBjb25zdCB1cmxzID0gWydsYW1wcycsICdydWxlcycsICdtY2MnLCAnY291bnRzP2Zvcm1hdEJ5PWRhdGUnLCAncGxhY2VzJ107XG5cbiAgY29uc3QgcmVxUHJvbWlzZXMgPSB1cmxzLm1hcChmdW5jdGlvbiAodXJsKSB7XG4gICAgcmV0dXJuICQuYWpheCh7XG4gICAgICB1cmw6IHJvb3RfdXJsICsgdXJsLFxuICAgICAgZGF0YVR5cGU6IFwiSlNPTlwiLFxuICAgICAgdHlwZTogXCJHRVRcIlxuICAgIH0pO1xuICB9KTtcblxuICBQcm9taXNlLmFsbChyZXFQcm9taXNlcykudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgY29uc29sZS5sb2cocmVzKVxuICAgIGxldCBydWxlXG4gICAgWyBidWNrZXRKc29uLCBydWxlLCBldmVudEpzb24sXG4gICAgICBjb3VudEpzb24sIHBsYWNlSnNvbl0gPSByZXNcblxuICAgIG1jY0Rpc3RhbmNlTG93ZXJMaW1pdCA9IHJ1bGVbMF0uZGlzdGFuY2VfbG93ZXJfbGltaXRcblxuICAgIGF2YWlsYWJsZURhdGVzID0gZ2V0S2V5cyhjb3VudEpzb24pXG4gICAgZ2V0UGxhY2VOYW1lID0gZ2V0UGxhY2VOYW1lRnVuYyhwbGFjZUpzb24pXG4gICAgZ2V0Q291bnQgPSBnZXRDb3VudEZ1bmMoY291bnRKc29uKVxuXG4gICAgaW5pdE1hcCgpO1xuICAgIHNldE1hcFRpdGxlKCfoq4vpgbjmk4fml6XmnJ/ljYDplpMnKVxuXG4gIH0pLmNhdGNoKChlcnIpPT57XG4gICAgY29uc29sZS5sb2coZXJyKVxuICAgIHNldE1hcFRpdGxlKGDos4fmlpnpjK/oqqTvvJoke2Vyci5zdGF0dXN9ICR7ZXJyLnN0YXR1c1RleHR9YClcbiAgfSlcbn0pO1xuXG5mdW5jdGlvbiBpbml0TWFwKCkge1xuICBtYXAgPSBMLm1hcCgnbWFwJykuc2V0Vmlldyhjb3VudHJ5Vmlld1tcIuWPsOWNl1wiXSwgMTQpXG5cbiAgTC50aWxlTGF5ZXIoJ2h0dHBzOi8vYXBpLm1hcGJveC5jb20vc3R5bGVzL3YxL21hcGJveC9kYXJrLXY5L3RpbGVzLzI1Ni97en0ve3h9L3t5fT9hY2Nlc3NfdG9rZW49e2FjY2Vzc1Rva2VufScsIHtcbiAgICBhdHRyaWJ1dGlvbjogJ01hcCBkYXRhICZjb3B5OyA8YSBocmVmPVwiaHR0cDovL29wZW5zdHJlZXRtYXAub3JnXCI+T3BlblN0cmVldE1hcDwvYT4gY29udHJpYnV0b3JzLCA8YSBocmVmPVwiaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvYnktc2EvMi4wL1wiPkNDLUJZLVNBPC9hPiwgSW1hZ2VyeSDCqSA8YSBocmVmPVwiaHR0cDovL21hcGJveC5jb21cIj5NYXBib3g8L2E+JyxcbiAgICBtYXhab29tOiAxOCxcbiAgICBpZDogJ2NoaW5nNTYuMTdobmc2amEnLFxuICAgIGFjY2Vzc1Rva2VuOiAncGsuZXlKMUlqb2lZMmhwYm1jMU5pSXNJbUVpT2lKamFYTmlabVl5ZEdNd01UTjFNbnB3Ym5OcU5XVnFNMnBsSW4wLms3aC1QVUdYN1RsNXhMd0RIM1Fwc2cnXG4gIH0pLmFkZFRvKG1hcCk7XG4gICQoXCIjbWFwXCIpLmhpZGUoKTtcbiAgJChcIiNtYXBcIikuZmFkZUluKCk7XG5cbiAgY29uc3Qgd2Vla0VnZ0xlZ2VuZCA9IEwuY29udHJvbCh7XG4gICAgcG9zaXRpb246ICdib3R0b21yaWdodCdcbiAgfSk7XG5cbiAgd2Vla0VnZ0xlZ2VuZC5vbkFkZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBkaXYgPSBMLkRvbVV0aWwuY3JlYXRlKCdkaXYnLCAnaW5mbyBsZWdlbmQnKSxcbiAgICAgIGdyYWRlcyA9IFswLCAxLCA1MCwgMTAwLCAxNTAsIDIwMF07XG5cbiAgICBkaXYuaW5uZXJIVE1MICs9ICc8c3BhbiBjbGFzcyA9IFwibGVnZW5kLWhlYWRlclwiPuaNleeNsuaVuO+8iOWAi++8iTxocj4nO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZ3JhZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoZ3JhZGVzW2ldID09PSAwKSB7XG4gICAgICAgIGRpdi5pbm5lckhUTUwgKz0gJzxkaXYgY2xhc3M9XCIgYmFycmVsX2xlZ2VuZFwiIGlkPVwiZ3JhZGVfJyArIGkgKyAnXCI+JyArICc8aSBzdHlsZT1cImJhY2tncm91bmQ6JyArIGdldEljb25TdHlsZVJHQkEoZ3JhZGVzW2ldKSArICdcIj48L2k+JyArIGdyYWRlc1tpXSArICc8YnI+PC9kaXY+JztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRpdi5pbm5lckhUTUwgKz0gJzxkaXYgY2xhc3M9XCIgYmFycmVsX2xlZ2VuZFwiIGlkPVwiZ3JhZGVfJyArIGkgKyAnXCI+JyArICc8aSBzdHlsZT1cImJhY2tncm91bmQ6JyArIGdldEljb25TdHlsZVJHQkEoZ3JhZGVzW2ldKSArICdcIj48L2k+JyArIGdyYWRlc1tpXSArIChncmFkZXNbaSArIDFdID8gJyAmbmRhc2g7ICcgKyAoZ3JhZGVzW2kgKyAxXSAtIDEpICsgJzxicj48L2Rpdj4nIDogJyA8YnI+PC9kaXY+Jyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZGl2LmlubmVySFRNTCArPSAnPGRpdiBjbGFzcz1cIiBiYXJyZWxfbGVnZW5kXCIgaWQ9XCJncmFkZV9vdGhlclwiPicgKyAnPGkgc3R5bGU9XCJiYWNrZ3JvdW5kOiNjY2NjY2NcIj48L2k+JyArICfnhKHos4fmlpknICsgJzxicj48L2Rpdj4nO1xuXG4gICAgcmV0dXJuIGRpdjtcbiAgfTtcblxuICB3ZWVrRWdnTGVnZW5kLmFkZFRvKG1hcCk7XG59XG5cbmZ1bmN0aW9uIGRhdGVwaWNrZXJPbkNoYW5nZSgpIHtcbiAgbGV0IGRhdGFJbkludGVydmFsID0ge31cbiAgY29uc3Qgc3RhcnREYXRlID0gbW9tZW50KCQoJy5yYW5nZS1zdGFydCcpLnZhbCgpKVxuICBjb25zdCBlbmREYXRlID0gbW9tZW50KCQoJy5yYW5nZS1lbmQnKS52YWwoKSlcbiAgY29uc3QgZXZlbnRzID0gZXZlbnRKc29uLnNsaWNlKCkuZmlsdGVyKChkKSA9PiB7XG4gICAgY29uc3QgZXZlbnREYXRlID0gbW9tZW50LnR6KGQuY3JlYXRlZF9hdCwgJ0FzaWEvVGFpcGVpJylcbiAgICByZXR1cm4gZXZlbnREYXRlIDw9IGVuZERhdGUgJiYgZXZlbnREYXRlID49IHN0YXJ0RGF0ZVxuICB9KVxuXG4gIGlmKCBzdGFydERhdGU9PT0nJyB8fCBlbmREYXRlID09PSAnJylcbiAgICByZXR1cm5cblxuICBhdmFpbGFibGVEYXRlcy5mb3JFYWNoKChkKSA9PiB7XG4gICAgbGV0IHRoaXNEYXkgPSBtb21lbnQoZClcbiAgICBpZiAodGhpc0RheSA+PSBzdGFydERhdGUgJiYgdGhpc0RheSA8PSBlbmREYXRlKSB7XG4gICAgICBsZXQgdGhpc0RheUtleSA9IHRoaXNEYXkuZm9ybWF0KCdZWVlZLU1NLUREJylcbiAgICAgIGRhdGFJbkludGVydmFsW3RoaXNEYXlLZXldID0gZ2V0Q291bnQodGhpc0RheUtleSlcbiAgICB9XG4gIH0pXG5cbiAgaW5zZXJ0QnVja2V0TGlzdChkYXRhSW5JbnRlcnZhbCk7XG4gIHJlbmRlckV2ZW50KGV2ZW50cylcbn1cblxuZnVuY3Rpb24gaW5zZXJ0QnVja2V0TGlzdChkYXRlRGF0YU1hcCkge1xuICBjb25zdCBoYXNTdGFydERhdGUgPSAhKCQoJy5yYW5nZS1zdGFydCcpLnZhbCgpID09PSAnJylcbiAgY29uc3QgaGFzRW5kRGF0ZSA9ICEoJCgnLnJhbmdlLWVuZCcpLnZhbCgpID09PSAnJylcbiAgY29uc3Qgc3RhcnREYXRlID0gaGFzU3RhcnREYXRlID8gbW9tZW50KCQoJy5yYW5nZS1zdGFydCcpLnZhbCgpKS5mb3JtYXQoJ1lZWVktTU0tREQnKSA6ICfmnKrpgbjmk4fotbflp4vml6XmnJ8nXG4gIGNvbnN0IGVuZERhdGUgPSBoYXNFbmREYXRlID8gbW9tZW50KCQoJy5yYW5nZS1lbmQnKS52YWwoKSkuZm9ybWF0KCdZWVlZLU1NLUREJykgOiAn5pyq6YG45pOH57WQ5p2f5pel5pyfJ1xuICBjb25zdCBsYW1wU3VtRGF0YSA9IHt9XG4gICQoXCIubWFwLWNvbnRhaW5lciAubGlzdC1ncm91cFwiKS5lbXB0eSgpO1xuICBjbGVhck1hcCgpO1xuXG4gIGlmIChnZXRLZXlzKGRhdGVEYXRhTWFwKS5sZW5ndGggPT09IDApIHtcbiAgICBsZXQgaW5mbyA9ICfmspLmnInos4fmlpknXG4gICAgaWYgKCFoYXNFbmREYXRlIHx8ICFoYXNTdGFydERhdGUpIHtcbiAgICAgIGluZm8gPSAnJ1xuICAgIH1cbiAgICBzZXRNYXBUaXRsZShgJHtzdGFydERhdGV9IH4gJHtlbmREYXRlfSAke2luZm99YClcbiAgfSBlbHNlIHtcbiAgICBzZXRNYXBUaXRsZShgJHtzdGFydERhdGV9IH4gJHtlbmREYXRlfSDljYDplpPos4fmlplgKVxuICB9XG5cbiAgZm9yIChsZXQgZGF0ZSBpbiBkYXRlRGF0YU1hcCkge1xuICAgIGxldCB0aGlzRGF5Q291bnREYXRhID0gZGF0ZURhdGFNYXBbZGF0ZV1cbiAgICBmb3IgKGxldCBpZCBpbiB0aGlzRGF5Q291bnREYXRhKSB7XG4gICAgICBjb25zdCBjb3VudCA9IHRoaXNEYXlDb3VudERhdGFbaWRdXG4gICAgICBjb25zdCBsYW1wID0gYnVja2V0SnNvbi5maW5kKChkKSA9PiB7XG4gICAgICAgIHJldHVybiBkLmxhbXBfaWQgPT09IGlkXG4gICAgICB9KVxuICAgICAgY29uc3QgcGxhY2UgPSBnZXRQbGFjZU5hbWUobGFtcC5wbGFjZV9pZClcbiAgICAgIGluc2VydEJ1Y2tldEh0bWwocGxhY2UsIGxhbXAsIGNvdW50LCBkYXRlKTtcbiAgICAgIGlmICghbGFtcFN1bURhdGFbbGFtcC5sYW1wX2lkXSkge1xuICAgICAgICBsYW1wU3VtRGF0YVtsYW1wLmxhbXBfaWRdID0ge31cbiAgICAgICAgbGFtcFN1bURhdGFbbGFtcC5sYW1wX2lkXS5sYW1wID0gbGFtcFxuICAgICAgICBsYW1wU3VtRGF0YVtsYW1wLmxhbXBfaWRdLmNvdW50ID0gMFxuICAgICAgfVxuICAgICAgY29uc3QgbGFtcENvdW50ID0gbGFtcFN1bURhdGFbbGFtcC5sYW1wX2lkXS5jb3VudFxuICAgICAgbGFtcFN1bURhdGFbbGFtcC5sYW1wX2lkXS5jb3VudCA9IGxhbXBDb3VudCArIGNvdW50XG4gICAgfVxuICB9XG4gIGJpbmRQb3B1cHMobGFtcFN1bURhdGEpO1xuICAkKCcjbWFwJykuZmFkZUluKClcbn1cblxuZnVuY3Rpb24gaW5zZXJ0QnVja2V0SHRtbChpbmZvLCBidWNrZXQsIGNvdW50LCBkYXRlKSB7XG4gIGNvbnN0IGluc2VydEhUTUwgPSBgPGEgY2xhc3M9XCJsaXN0LWdyb3VwLWl0ZW0gXCI+XG4gICAgICAgIDxoNCBjbGFzcz1cImxpc3QtZ3JvdXAtaXRlbS1oZWFkaW5nXCI+PHNwYW4+JHtidWNrZXQubGFtcF9pZH1AJHtpbmZvfTwvc3Bhbj48c3Bhbj4mIzk4ODk7JHtjb3VudH08L3NwYW4+PC9oND5cbiAgICAgICAgPHAgY2xhc3M9XCJsaXN0LWdyb3VwLWl0ZW0tdGV4dFwiPiAke21vbWVudChkYXRlKS5mb3JtYXQoJ0xMJyl9PC9wPlxuICAgICAgPC9hPmBcbiAgJChcIi5tYXAtY29udGFpbmVyIC5saXN0LWdyb3VwXCIpLmFwcGVuZChpbnNlcnRIVE1MKTtcbn1cblxuZnVuY3Rpb24gZ2V0S2V5cyhvYmopIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMob2JqKTtcbiAgICByZXR1cm4ga2V5cztcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgcmV0dXJuIFtdO1xuICB9XG59XG5cbmZ1bmN0aW9uIHNldE1hcFRpdGxlKG1hcFRpdGxlKSB7XG4gIC8vIGNsZWFyIGxvYWRpbmcgdGV4dCBcbiAgY29uc3QgdGl0bGUgPSAkKGA8aDM+JHttYXBUaXRsZX08L2gzPmApXG4gICQoJy5saXN0LWdyb3VwJykuZW1wdHkoKVxuICAkKCcubGlzdC1ncm91cCcpLmFwcGVuZCh0aXRsZSlcbiAgXG4gIHRpdGxlLmhpZGUoKTtcbiAgdGl0bGUuZmFkZUluKCdzbG93Jyk7XG59XG5cbmZ1bmN0aW9uIHJlbmRlckV2ZW50KGV2ZW50cykge1xuICBldmVudHMuZm9yRWFjaChmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBjb25zdCBsYXRsbmcgPSBbZXZlbnQubWNjX2NlbnRlclsxXSwgZXZlbnQubWNjX2NlbnRlclswXV1cbiAgICBjb25zdCByYWRpdXMgPSBtY2NEaXN0YW5jZUxvd2VyTGltaXRcbiAgICBjb25zdCBjaXJjbGUgPSBMLmNpcmNsZShsYXRsbmcsIHtcbiAgICAgIHJhZGl1czogcmFkaXVzXG4gICAgfSlcbiAgICBjaXJjbGVzLnB1c2goY2lyY2xlKVxuICAgIGNpcmNsZS5hZGRUbyhtYXApO1xuICB9KVxufVxuXG5mdW5jdGlvbiBjbGVhck1hcCgpIHtcbiAgbWFya2VyQXJyYXkuZm9yRWFjaChmdW5jdGlvbiAobWFya2VyKSB7XG4gICAgbWFwLnJlbW92ZUxheWVyKG1hcmtlcik7XG4gIH0pO1xuXG4gIGNpcmNsZXMuZm9yRWFjaChmdW5jdGlvbiAoY2lyY2xlKSB7XG4gICAgY2lyY2xlLnJlbW92ZSgpXG4gIH0pXG5cbiAgY2lyY2xlcyA9IFtdXG5cbiAgJChcIiNtYXBcIikuaGlkZSgpO1xufVxuXG5mdW5jdGlvbiBiaW5kUG9wdXBzKGxhbXBTdW1EYXRhKSB7XG5cbiAgY29uc3QgU0NBTEUgPSA4MDtcblxuICBmb3IoIGxldCBpZCBpbiBsYW1wU3VtRGF0YSApe1xuICAgIGNvbnN0IGxhbXAgPSBsYW1wU3VtRGF0YVtpZF0ubGFtcFxuICAgIGNvbnN0IGNvdW50ID0gbGFtcFN1bURhdGFbaWRdLmNvdW50XG4gICAgY29uc3QgbGF0ID0gbGFtcC5sYW1wX2xvY2F0aW9uWzFdXG4gICAgY29uc3QgbG5nID0gbGFtcC5sYW1wX2xvY2F0aW9uWzBdXG4gICAgY29uc3QgaWNvbiA9IEwuaWNvbih7XG4gICAgICBpY29uVXJsOiBnZXRJY29uU3R5bGUoY291bnQpLFxuICAgICAgaWNvblNpemU6IFs0NSwgODBdLCAvLyBzaXplIG9mIHRoZSBpY29uXG4gICAgICBwb3B1cEFuY2hvcjogWzAsIC00MF0sXG4gICAgICBpY29uQW5jaG9yOiBbMjIsIDYwXSxcbiAgICAgIGNsYXNzTmFtZTogZ2V0SWNvbkNhdChjb3VudCksXG4gICAgfSk7XG4gICAgY29uc3QgUG9wVXBDb250ZW50ID0gKGA8dGFibGU+XG4gICAgICA8dHI+XG4gICAgICAgIDx0aD4gSUQgPC90aD5cbiAgICAgICAgPHRkPiAke2xhbXAubGFtcF9pZH0gPC90ZD5cbiAgICAgIDwvdHI+XG4gICAgICA8dHI+XG4gICAgICAgIDx0aD7lnLDpu548L3RoPlxuICAgICAgICA8dGQ+JHtnZXRQbGFjZU5hbWUobGFtcC5wbGFjZV9pZCl9PC90ZD5cbiAgICAgIDwvdHI+XG4gICAgICAgIDx0cj5cbiAgICAgICAgPHRoPuaNleeNsjwvdGg+XG4gICAgICAgIDx0ZD4ke2NvdW50fTwvdGQ+XG4gICAgICA8L3RyPlxuICAgICAgPC90YWJsZT5gKVxuICAgIGNvbnN0IG1hcmtlciA9IEwubWFya2VyKFtsYXQsIGxuZ10sIHtcbiAgICAgIGljb246IGljb25cbiAgICB9KS5iaW5kUG9wdXAoUG9wVXBDb250ZW50KS5hZGRUbyhtYXApO1xuICAgIG1hcmtlckFycmF5LnB1c2gobWFya2VyKTtcbiAgfVxuICBpZiggbWFya2VyQXJyYXkubGVuZ3RoID4gMCl7XG4gICAgY29uc3QgZ3JvdXAgPSBuZXcgTC5mZWF0dXJlR3JvdXAobWFya2VyQXJyYXkpO1xuICAgIG1hcC5maXRCb3VuZHMoZ3JvdXAuZ2V0Qm91bmRzKCkpO1xuICB9IFxufVxuXG5mdW5jdGlvbiBnZXRJY29uU3R5bGUoYW1vdW50KSB7XG4gIGxldCBzdHlsZTtcbiAgaWYgKGFtb3VudCA9PT0gMCkge1xuICAgIHN0eWxlID0gJ2xlZ2VuZDEnO1xuICB9IGVsc2UgaWYgKGFtb3VudCA+IDAgJiYgYW1vdW50IDw9IDQ5KSB7XG4gICAgc3R5bGUgPSAnbGVnZW5kMic7XG4gIH0gZWxzZSBpZiAoYW1vdW50ID49IDUwICYmIGFtb3VudCA8PSA5OSkge1xuICAgIHN0eWxlID0gJ2xlZ2VuZDMnO1xuICB9IGVsc2UgaWYgKGFtb3VudCA+PSAxMDAgJiYgYW1vdW50IDw9IDE0OSkge1xuICAgIHN0eWxlID0gJ2xlZ2VuZDQnO1xuICB9IGVsc2UgaWYgKGFtb3VudCA+PSAxNTAgJiYgYW1vdW50IDw9IDE5OSkge1xuICAgIHN0eWxlID0gJ2xlZ2VuZDUnO1xuICB9IGVsc2UgaWYgKGFtb3VudCA+PSAyMDApIHtcbiAgICBzdHlsZSA9ICdsZWdlbmQ2JztcbiAgfSBlbHNlIHtcbiAgICBzdHlsZSA9ICdsZWdlbmRfdW5kZWZpbmVkJztcbiAgfVxuICByZXR1cm4gJ2ltYWdlcy8nICsgc3R5bGUgKyAnLnN2Zyc7XG59XG5cbmZ1bmN0aW9uIGdldEljb25DYXQoYW1vdW50KSB7XG4gIGxldCBjYXRlZ29yeTtcbiAgaWYgKGFtb3VudCA9PT0gMCkge1xuICAgIGNhdGVnb3J5ID0gJ2dyYWRlXzAnO1xuICB9IGVsc2UgaWYgKGFtb3VudCA+IDAgJiYgYW1vdW50IDw9IDQ5KSB7XG4gICAgY2F0ZWdvcnkgPSAnZ3JhZGVfMSc7XG4gIH0gZWxzZSBpZiAoYW1vdW50ID49IDUwICYmIGFtb3VudCA8PSA5OSkge1xuICAgIGNhdGVnb3J5ID0gJ2dyYWRlXzInO1xuICB9IGVsc2UgaWYgKGFtb3VudCA+PSAxMDAgJiYgYW1vdW50IDw9IDE0OSkge1xuICAgIGNhdGVnb3J5ID0gJ2dyYWRlXzMnO1xuICB9IGVsc2UgaWYgKGFtb3VudCA+PSAxNTAgJiYgYW1vdW50IDw9IDE5OSkge1xuICAgIGNhdGVnb3J5ID0gJ2dyYWRlXzQnO1xuICB9IGVsc2UgaWYgKGFtb3VudCA+PSAyMDApIHtcbiAgICBjYXRlZ29yeSA9ICdncmFkZV81JztcbiAgfSBlbHNlIHtcbiAgICBjYXRlZ29yeSA9ICdncmFkZV9vdGhlcic7XG4gIH1cbiAgcmV0dXJuIGNhdGVnb3J5O1xufVxuXG5mdW5jdGlvbiBnZXRJY29uU3R5bGVSR0JBKGFtb3VudCkge1xuICBsZXQgc3R5bGU7XG4gIGlmIChhbW91bnQgPT09IDApIHtcbiAgICBzdHlsZSA9ICcjMDBGRjlEJztcbiAgfSBlbHNlIGlmIChhbW91bnQgPiAwICYmIGFtb3VudCA8PSA0OSkge1xuICAgIHN0eWxlID0gJyMzM0NDN0UnO1xuICB9IGVsc2UgaWYgKGFtb3VudCA+PSA1MCAmJiBhbW91bnQgPD0gOTkpIHtcbiAgICBzdHlsZSA9ICcjNjY5OTVFJztcbiAgfSBlbHNlIGlmIChhbW91bnQgPj0gMTAwICYmIGFtb3VudCA8PSAxNDkpIHtcbiAgICBzdHlsZSA9ICcjOTk2NjNGJztcbiAgfSBlbHNlIGlmIChhbW91bnQgPj0gMTUwICYmIGFtb3VudCA8PSAxOTkpIHtcbiAgICBzdHlsZSA9ICcjQ0MzMzFGJztcbiAgfSBlbHNlIGlmIChhbW91bnQgPj0gMjAwKSB7XG4gICAgc3R5bGUgPSAnI0ZGMDAwMCc7XG4gIH1cblxuICByZXR1cm4gc3R5bGU7XG59Il19\n"]}