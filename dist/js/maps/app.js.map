{"version":3,"sources":["app.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","initMap","map","L","setView","countryView","tileLayer","attribution","maxZoom","id","accessToken","addTo","$","hide","fadeIn","weekEggLegend","control","position","onAdd","div","DomUtil","create","grades","innerHTML","getIconStyleRGBA","on","selectedClass","this","val","prop","css","datepickerOnChange","availableDatesInInterval","dataInInterval","startDate","moment","endDate","events","eventJson","slice","filter","d","eventDate","tz","created_at","availableDates","forEach","thisDay","push","thisDayKey","format","getCount","insertBucketList","renderEvent","dateDataMap","hasStartDate","hasEndDate","lampSumData","empty","clearMap","getKeys","info","setMapTitle","date","thisDayCountData","count","lamp","bucketJson","find","lamp_id","insertBucketHtml","getPlaceName","place_id","lampCount","_loop","bindPopups","bucket","insertHTML","append","obj","Object","keys","err","mapTitle","title","event","latlng","mcc_center","radius","mccDistanceLowerLimit","circle","circles","markerArray","marker","removeLayer","remove","console","log","_lamp","lat","lamp_location","lng","icon","iconUrl","getIconStyle","iconSize","popupAnchor","iconAnchor","className","getIconCat","PopUpContent","bindPopup","group","featureGroup","fitBounds","getBounds","amount","style","_slicedToArray","sliceIterator","arr","_arr","_n","_d","_e","undefined","_s","_i","Symbol","iterator","next","done","value","Array","isArray","TypeError","countJson","placeJson","locale","getPlaceNameFunc","placeMap","place_name","getCountFunc","countMap","dateData","sum","台南","高雄","屏東","document","ready","datepicker","autoclose","zIndexOffset","disableTouchKeyboard","reqPromises","url","ajax","dataType","type","Promise","all","then","res","rule","_res","distance_lower_limit","catch","status","statusText"],"mappings":"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","file":"../app.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar bucketJson = [];\nvar eventJson = [];\nvar countJson = [];\nvar placeJson = [];\nvar mccDistanceLowerLimit = void 0;\nvar map = void 0;\nvar markerArray = [];\nvar circles = [];\nvar getPlaceName = void 0;\nvar getCount = void 0;\nvar availableDates = void 0;\n\nmoment.locale('zh-tw');\n\nvar getPlaceNameFunc = function getPlaceNameFunc(placeJson) {\n  var placeMap = {};\n  placeJson.forEach(function (d) {\n    placeMap[d.place_id] = d.place_name;\n  });\n  return function (id) {\n    return placeMap[id];\n  };\n};\n\nvar getCountFunc = function getCountFunc(countJson) {\n  var countMap = {};\n  availableDates.forEach(function (d) {\n    countMap[d] = {};\n  });\n  for (var i in countJson) {\n    var dateData = countJson[i];\n    for (var id in dateData) {\n      countMap[i][id] = +dateData[id].sum;\n    }\n  }\n  return function (date) {\n    return countMap[date];\n  };\n};\nvar countryView = {\n  '台南': [22.9971, 120.1926],\n  '高雄': [22.6397615, 120.2999183],\n  '屏東': [22.667431, 120.486307]\n};\n\n$(document).ready(function () {\n  setMapTitle('資料載入中...');\n  $('.range-start').datepicker({\n    'autoclose': true,\n    'zIndexOffset': 1000,\n    'format': 'yyyy-mm-dd',\n    'disableTouchKeyboard': true\n  }).on('changeDate', datepickerOnChange);\n  $('.range-end').datepicker({\n    'autoclose': true,\n    'zIndexOffset': 1000,\n    'format': 'yyyy-mm-dd',\n    'disableTouchKeyboard': true\n  }).on('changeDate', datepickerOnChange);\n\n  var root_url = 'http://140.116.249.228:3000/apis/';\n  var urls = ['lamps', 'rules', 'mcc', 'counts?formatBy=date', 'places'];\n  var reqPromises = urls.map(function (url) {\n    return $.ajax({\n      url: root_url + url,\n      // url: url + '.json', //for debug\n      dataType: \"JSON\",\n      type: \"GET\"\n    });\n  });\n\n  Promise.all(reqPromises).then(function (res) {\n    var rule = void 0;\n\n    var _res = _slicedToArray(res, 5);\n\n    bucketJson = _res[0];\n    rule = _res[1];\n    eventJson = _res[2];\n    countJson = _res[3];\n    placeJson = _res[4];\n\n\n    mccDistanceLowerLimit = rule[0].distance_lower_limit;\n\n    console.log(res);\n\n    availableDates = getKeys(countJson);\n    getPlaceName = getPlaceNameFunc(placeJson);\n    getCount = getCountFunc(countJson);\n    initMap();\n    setMapTitle('請選擇日期區間');\n  }).catch(function (err) {\n    setMapTitle('\\u8CC7\\u6599\\u932F\\u8AA4\\uFF1A' + err.status + ' ' + err.statusText);\n    console.log(err);\n  });\n});\n\nfunction initMap() {\n  map = L.map('map').setView(countryView[\"台南\"], 14);\n\n  L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/dark-v9/tiles/256/{z}/{x}/{y}?access_token={accessToken}', {\n    attribution: 'Map data &copy; <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, Imagery © <a href=\"http://mapbox.com\">Mapbox</a>',\n    maxZoom: 18,\n    id: 'ching56.17hng6ja',\n    accessToken: 'pk.eyJ1IjoiY2hpbmc1NiIsImEiOiJjaXNiZmYydGMwMTN1MnpwbnNqNWVqM2plIn0.k7h-PUGX7Tl5xLwDH3Qpsg'\n  }).addTo(map);\n  $(\"#map\").hide();\n  $(\"#map\").fadeIn();\n\n  var weekEggLegend = L.control({\n    position: 'bottomright'\n  });\n\n  weekEggLegend.onAdd = function () {\n    var div = L.DomUtil.create('div', 'info legend'),\n        grades = [0, 1, 50, 100, 150, 200];\n\n    div.innerHTML += '<span class = \"legend-header\">捕獲數（個）<hr>';\n    for (var i = 0; i < grades.length; i++) {\n      if (grades[i] === 0) {\n        div.innerHTML += '<div class=\" barrel_legend\" id=\"grade_' + i + '\">' + '<i style=\"background:' + getIconStyleRGBA(grades[i]) + '\"></i>' + grades[i] + '<br></div>';\n      } else {\n        div.innerHTML += '<div class=\" barrel_legend\" id=\"grade_' + i + '\">' + '<i style=\"background:' + getIconStyleRGBA(grades[i]) + '\"></i>' + grades[i] + (grades[i + 1] ? ' &ndash; ' + (grades[i + 1] - 1) + '<br></div>' : ' <br></div>');\n      }\n    }\n\n    div.innerHTML += '<div class=\" barrel_legend\" id=\"grade_other\">' + '<i style=\"background:#cccccc\"></i>' + '無資料' + '<br></div>';\n\n    return div;\n  };\n\n  weekEggLegend.addTo(map);\n  $(\".barrel_legend > input\").on(\"click\", function () {\n    var selectedClass = '.' + $(this).val();\n    if ($(this).prop(\"checked\")) {\n      $(selectedClass).css('display', 'block');\n    } else {\n      $(selectedClass).css('display', 'none');\n    }\n  });\n}\n\nfunction datepickerOnChange() {\n  var availableDatesInInterval = [];\n  var dataInInterval = {};\n  var startDate = moment($('.range-start').val());\n  var endDate = moment($('.range-end').val());\n  var events = eventJson.slice().filter(function (d) {\n    var eventDate = moment.tz(d.created_at, 'Asia/Taipei');\n    return eventDate <= endDate && eventDate >= startDate;\n  });\n\n  if (startDate === '' || endDate === '') return;\n\n  availableDates.forEach(function (d) {\n    var thisDay = moment(d);\n    if (thisDay >= startDate && thisDay <= endDate) {\n      availableDatesInInterval.push(thisDay);\n    }\n  });\n\n  availableDatesInInterval.forEach(function (d) {\n    var thisDayKey = d.format('YYYY-MM-DD');\n    dataInInterval[thisDayKey] = getCount(thisDayKey);\n  });\n\n  insertBucketList(dataInInterval);\n  renderEvent(events);\n}\n\nfunction insertBucketList(dateDataMap) {\n  var hasStartDate = !($('.range-start').val() === '');\n  var hasEndDate = !($('.range-end').val() === '');\n  var startDate = hasStartDate ? moment($('.range-start').val()).format('YYYY-MM-DD') : '未選擇起始日期';\n  var endDate = hasEndDate ? moment($('.range-end').val()).format('YYYY-MM-DD') : '未選擇結束日期';\n  var lampSumData = {};\n  $(\".map-container .list-group\").empty();\n  clearMap();\n\n  if (getKeys(dateDataMap).length === 0) {\n    var info = '沒有資料';\n    if (!hasEndDate || !hasStartDate) {\n      info = '';\n    }\n    setMapTitle(startDate + ' ~ ' + endDate + ' ' + info);\n  } else {\n    setMapTitle(startDate + ' ~ ' + endDate + ' \\u5340\\u9593\\u8CC7\\u6599');\n  }\n\n  for (var date in dateDataMap) {\n    var thisDayCountData = dateDataMap[date];\n\n    var _loop = function _loop(id) {\n      var count = thisDayCountData[id];\n      var lamp = bucketJson.find(function (d) {\n        return d.lamp_id === id;\n      });\n      var place = getPlaceName(lamp.place_id);\n      insertBucketHtml(place, lamp, count, date);\n      if (!lampSumData[lamp.lamp_id]) {\n        lampSumData[lamp.lamp_id] = {};\n        lampSumData[lamp.lamp_id].lamp = lamp;\n        lampSumData[lamp.lamp_id].count = 0;\n      }\n      var lampCount = lampSumData[lamp.lamp_id].count;\n      lampSumData[lamp.lamp_id].count = lampCount + count;\n    };\n\n    for (var id in thisDayCountData) {\n      _loop(id);\n    }\n  }\n  bindPopups(lampSumData);\n  $('#map').fadeIn();\n}\n\nfunction insertBucketHtml(info, bucket, count, date) {\n  var insertHTML = '<a class=\"list-group-item \">\\n        <h4 class=\"list-group-item-heading\"><span>' + bucket.lamp_id + '@' + info + '</span><span>&#9889;' + count + '</span></h4>\\n        <p class=\"list-group-item-text\"> ' + moment(date).format('LL') + '</p>\\n      </a>';\n  $(\".map-container .list-group\").append(insertHTML);\n}\n\nfunction getKeys(obj) {\n  try {\n    var keys = Object.keys(obj);\n    return keys;\n  } catch (err) {\n    return [];\n  }\n}\n\nfunction setMapTitle(mapTitle) {\n  // clear loading text \n  var title = $('<h3>' + mapTitle + '</h3>');\n  $('.list-group').empty();\n  $('.list-group').append(title);\n\n  title.hide();\n  title.fadeIn('slow');\n}\n\nfunction renderEvent(events) {\n  events.forEach(function (event) {\n    var latlng = [event.mcc_center[1], event.mcc_center[0]];\n    var radius = mccDistanceLowerLimit;\n    var circle = L.circle(latlng, {\n      radius: radius\n    });\n    circles.push(circle);\n    circle.addTo(map);\n  });\n}\n\nfunction clearMap() {\n  markerArray.forEach(function (marker) {\n    map.removeLayer(marker);\n  });\n\n  circles.forEach(function (circle) {\n    circle.remove();\n  });\n\n  circles = [];\n\n  $(\"#map\").hide();\n}\n\nfunction bindPopups(lampSumData) {\n\n  var SCALE = 80;\n\n  for (var id in lampSumData) {\n    console.log(lampSumData);\n    var _lamp = lampSumData[id].lamp;\n    var count = lampSumData[id].count;\n    var lat = _lamp.lamp_location[1];\n    var lng = _lamp.lamp_location[0];\n    var icon = L.icon({\n      iconUrl: getIconStyle(count),\n      iconSize: [45, 80], // size of the icon\n      popupAnchor: [0, -40],\n      iconAnchor: [22, 60],\n      className: getIconCat(count)\n    });\n    var PopUpContent = '<table>\\n      <tr>\\n        <th> ID </th>\\n        <td> ' + _lamp.lamp_id + ' </td>\\n      </tr>\\n      <tr>\\n        <th>\\u5730\\u9EDE</th>\\n        <td>' + getPlaceName(_lamp.place_id) + '</td>\\n      </tr>\\n        <tr>\\n        <th>\\u6355\\u7372</th>\\n        <td>' + count + '</td>\\n      </tr>\\n      </table>';\n    var marker = L.marker([lat, lng], {\n      icon: icon\n    }).bindPopup(PopUpContent).addTo(map);\n    markerArray.push(marker);\n  }\n  if (markerArray.length > 0) {\n    var group = new L.featureGroup(markerArray);\n    map.fitBounds(group.getBounds());\n  }\n}\n\nfunction getIconStyle(amount) {\n  var style = void 0;\n  if (amount === 0) {\n    style = 'legend1';\n  } else if (amount > 0 && amount <= 49) {\n    style = 'legend2';\n  } else if (amount >= 50 && amount <= 99) {\n    style = 'legend3';\n  } else if (amount >= 100 && amount <= 149) {\n    style = 'legend4';\n  } else if (amount >= 150 && amount <= 199) {\n    style = 'legend5';\n  } else if (amount >= 200) {\n    style = 'legend6';\n  } else {\n    style = 'legend_undefined';\n  }\n  return 'images/' + style + '.svg';\n}\n\nfunction getIconCat(amount) {\n  var category = void 0;\n  if (amount === 0) {\n    category = 'grade_0';\n  } else if (amount > 0 && amount <= 49) {\n    category = 'grade_1';\n  } else if (amount >= 50 && amount <= 99) {\n    category = 'grade_2';\n  } else if (amount >= 100 && amount <= 149) {\n    category = 'grade_3';\n  } else if (amount >= 150 && amount <= 199) {\n    category = 'grade_4';\n  } else if (amount >= 200) {\n    category = 'grade_5';\n  } else {\n    category = 'grade_other';\n  }\n  return category;\n}\n\nfunction getIconStyleRGBA(amount) {\n  var style = void 0;\n  if (amount === 0) {\n    style = '#00FF9D';\n  } else if (amount > 0 && amount <= 49) {\n    style = '#33CC7E';\n  } else if (amount >= 50 && amount <= 99) {\n    style = '#66995E';\n  } else if (amount >= 100 && amount <= 149) {\n    style = '#99663F';\n  } else if (amount >= 150 && amount <= 199) {\n    style = '#CC331F';\n  } else if (amount >= 200) {\n    style = '#FF0000';\n  }\n\n  return style;\n}\n\n},{}]},{},[1])\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYXBwLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7OztBQ0FBLElBQUksYUFBYSxFQUFqQjtBQUNBLElBQUksWUFBWSxFQUFoQjtBQUNBLElBQUksWUFBWSxFQUFoQjtBQUNBLElBQUksWUFBWSxFQUFoQjtBQUNBLElBQUksOEJBQUo7QUFDQSxJQUFJLFlBQUo7QUFDQSxJQUFJLGNBQWMsRUFBbEI7QUFDQSxJQUFJLFVBQVUsRUFBZDtBQUNBLElBQUkscUJBQUo7QUFDQSxJQUFJLGlCQUFKO0FBQ0EsSUFBSSx1QkFBSjs7QUFFQSxPQUFPLE1BQVAsQ0FBYyxPQUFkOztBQUVBLElBQUksbUJBQW1CLFNBQW5CLGdCQUFtQixDQUFVLFNBQVYsRUFBcUI7QUFDMUMsTUFBSSxXQUFXLEVBQWY7QUFDQSxZQUFVLE9BQVYsQ0FBa0IsVUFBVSxDQUFWLEVBQWE7QUFDN0IsYUFBUyxFQUFFLFFBQVgsSUFBdUIsRUFBRSxVQUF6QjtBQUNELEdBRkQ7QUFHQSxTQUFPLFVBQVUsRUFBVixFQUFjO0FBQ25CLFdBQU8sU0FBUyxFQUFULENBQVA7QUFDRCxHQUZEO0FBR0QsQ0FSRDs7QUFVQSxJQUFJLGVBQWUsU0FBZixZQUFlLENBQUMsU0FBRCxFQUFlO0FBQ2hDLE1BQUksV0FBVyxFQUFmO0FBQ0EsaUJBQWUsT0FBZixDQUF1QixVQUFDLENBQUQsRUFBTztBQUM1QixhQUFTLENBQVQsSUFBYyxFQUFkO0FBQ0QsR0FGRDtBQUdBLE9BQUssSUFBSSxDQUFULElBQWMsU0FBZCxFQUF5QjtBQUN2QixRQUFJLFdBQVcsVUFBVSxDQUFWLENBQWY7QUFDQSxTQUFLLElBQUksRUFBVCxJQUFlLFFBQWY7QUFDRSxlQUFTLENBQVQsRUFBWSxFQUFaLElBQWtCLENBQUMsU0FBUyxFQUFULEVBQWEsR0FBaEM7QUFERjtBQUVEO0FBQ0QsU0FBTyxVQUFD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b250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwibGV0IGJ1Y2tldEpzb24gPSBbXVxubGV0IGV2ZW50SnNvbiA9IFtdXG5sZXQgY291bnRKc29uID0gW11cbmxldCBwbGFjZUpzb24gPSBbXVxubGV0IG1jY0Rpc3RhbmNlTG93ZXJMaW1pdFxubGV0IG1hcDtcbmxldCBtYXJrZXJBcnJheSA9IFtdO1xubGV0IGNpcmNsZXMgPSBbXVxubGV0IGdldFBsYWNlTmFtZVxubGV0IGdldENvdW50XG5sZXQgYXZhaWxhYmxlRGF0ZXNcblxubW9tZW50LmxvY2FsZSgnemgtdHcnKVxuXG5sZXQgZ2V0UGxhY2VOYW1lRnVuYyA9IGZ1bmN0aW9uIChwbGFjZUpzb24pIHtcbiAgbGV0IHBsYWNlTWFwID0ge31cbiAgcGxhY2VKc29uLmZvckVhY2goZnVuY3Rpb24gKGQpIHtcbiAgICBwbGFjZU1hcFtkLnBsYWNlX2lkXSA9IGQucGxhY2VfbmFtZVxuICB9KVxuICByZXR1cm4gZnVuY3Rpb24gKGlkKSB7XG4gICAgcmV0dXJuIHBsYWNlTWFwW2lkXVxuICB9XG59XG5cbmxldCBnZXRDb3VudEZ1bmMgPSAoY291bnRKc29uKSA9PiB7XG4gIGxldCBjb3VudE1hcCA9IHt9XG4gIGF2YWlsYWJsZURhdGVzLmZvckVhY2goKGQpID0+IHtcbiAgICBjb3VudE1hcFtkXSA9IHt9XG4gIH0pXG4gIGZvciAobGV0IGkgaW4gY291bnRKc29uKSB7XG4gICAgbGV0IGRhdGVEYXRhID0gY291bnRKc29uW2ldXG4gICAgZm9yIChsZXQgaWQgaW4gZGF0ZURhdGEpXG4gICAgICBjb3VudE1hcFtpXVtpZF0gPSArZGF0ZURhdGFbaWRdLnN1bVxuICB9XG4gIHJldHVybiAoZGF0ZSkgPT4ge1xuICAgIHJldHVybiBjb3VudE1hcFtkYXRlXVxuICB9XG59XG5jb25zdCBjb3VudHJ5VmlldyA9IHtcbiAgJ+WPsOWNlyc6IFsyMi45OTcxLCAxMjAuMTkyNl0sXG4gICfpq5jpm4QnOiBbMjIuNjM5NzYxNSwgMTIwLjI5OTkxODNdLFxuICAn5bGP5p2xJzogWzIyLjY2NzQzMSwgMTIwLjQ4NjMwN11cbn1cblxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuICBzZXRNYXBUaXRsZSgn6LOH5paZ6LyJ5YWl5LitLi4uJylcbiAgJCgnLnJhbmdlLXN0YXJ0JykuZGF0ZXBpY2tlcih7XG4gICAgJ2F1dG9jbG9zZSc6IHRydWUsXG4gICAgJ3pJbmRleE9mZnNldCc6IDEwMDAsXG4gICAgJ2Zvcm1hdCc6ICd5eXl5LW1tLWRkJyxcbiAgICAnZGlzYWJsZVRvdWNoS2V5Ym9hcmQnOiB0cnVlXG4gIH0pLm9uKCdjaGFuZ2VEYXRlJywgZGF0ZXBpY2tlck9uQ2hhbmdlKVxuICAkKCcucmFuZ2UtZW5kJykuZGF0ZXBpY2tlcih7XG4gICAgJ2F1dG9jbG9zZSc6IHRydWUsXG4gICAgJ3pJbmRleE9mZnNldCc6IDEwMDAsXG4gICAgJ2Zvcm1hdCc6ICd5eXl5LW1tLWRkJyxcbiAgICAnZGlzYWJsZVRvdWNoS2V5Ym9hcmQnOiB0cnVlXG4gIH0pLm9uKCdjaGFuZ2VEYXRlJywgZGF0ZXBpY2tlck9uQ2hhbmdlKVxuXG4gIGNvbnN0IHJvb3RfdXJsID0gJ2h0dHA6Ly8xNDAuMTE2LjI0OS4yMjg6MzAwMC9hcGlzLydcbiAgY29uc3QgdXJscyA9IFsnbGFtcHMnLCAncnVsZXMnLCAnbWNjJywgJ2NvdW50cz9mb3JtYXRCeT1kYXRlJywgJ3BsYWNlcyddO1xuICBjb25zdCByZXFQcm9taXNlcyA9IHVybHMubWFwKGZ1bmN0aW9uICh1cmwpIHtcbiAgICByZXR1cm4gJC5hamF4KHtcbiAgICAgIHVybDogcm9vdF91cmwgKyB1cmwsXG4gICAgICAvLyB1cmw6IHVybCArICcuanNvbicsIC8vZm9yIGRlYnVnXG4gICAgICBkYXRhVHlwZTogXCJKU09OXCIsXG4gICAgICB0eXBlOiBcIkdFVFwiXG4gICAgfSk7XG4gIH0pO1xuXG4gIFByb21pc2UuYWxsKHJlcVByb21pc2VzKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcbiAgICBsZXQgcnVsZVxuXG4gICAgW1xuICAgICAgYnVja2V0SnNvbiwgXG4gICAgICBydWxlLFxuICAgICAgZXZlbnRKc29uLFxuICAgICAgY291bnRKc29uLFxuICAgICAgcGxhY2VKc29uXG4gICAgXSA9IHJlc1xuXG4gICAgbWNjRGlzdGFuY2VMb3dlckxpbWl0ID0gcnVsZVswXS5kaXN0YW5jZV9sb3dlcl9saW1pdFxuXG4gICAgY29uc29sZS5sb2cocmVzKVxuXG4gICAgYXZhaWxhYmxlRGF0ZXMgPSBnZXRLZXlzKGNvdW50SnNvbilcbiAgICBnZXRQbGFjZU5hbWUgPSBnZXRQbGFjZU5hbWVGdW5jKHBsYWNlSnNvbilcbiAgICBnZXRDb3VudCA9IGdldENvdW50RnVuYyhjb3VudEpzb24pXG4gICAgaW5pdE1hcCgpO1xuICAgIHNldE1hcFRpdGxlKCfoq4vpgbjmk4fml6XmnJ/ljYDplpMnKVxuICB9KS5jYXRjaCgoZXJyKT0+e1xuICAgIHNldE1hcFRpdGxlKGDos4fmlpnpjK/oqqTvvJoke2Vyci5zdGF0dXN9ICR7ZXJyLnN0YXR1c1RleHR9YClcbiAgICBjb25zb2xlLmxvZyhlcnIpXG4gIH0pXG59KTtcblxuZnVuY3Rpb24gaW5pdE1hcCgpIHtcbiAgbWFwID0gTC5tYXAoJ21hcCcpLnNldFZpZXcoY291bnRyeVZpZXdbXCLlj7DljZdcIl0sIDE0KVxuXG4gIEwudGlsZUxheWVyKCdodHRwczovL2FwaS5tYXBib3guY29tL3N0eWxlcy92MS9tYXBib3gvZGFyay12OS90aWxlcy8yNTYve3p9L3t4fS97eX0/YWNjZXNzX3Rva2VuPXthY2Nlc3NUb2tlbn0nLCB7XG4gICAgYXR0cmlidXRpb246ICdNYXAgZGF0YSAmY29weTsgPGEgaHJlZj1cImh0dHA6Ly9vcGVuc3RyZWV0bWFwLm9yZ1wiPk9wZW5TdHJlZXRNYXA8L2E+IGNvbnRyaWJ1dG9ycywgPGEgaHJlZj1cImh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LXNhLzIuMC9cIj5DQy1CWS1TQTwvYT4sIEltYWdlcnkgwqkgPGEgaHJlZj1cImh0dHA6Ly9tYXBib3guY29tXCI+TWFwYm94PC9hPicsXG4gICAgbWF4Wm9vbTogMTgsXG4gICAgaWQ6ICdjaGluZzU2LjE3aG5nNmphJyxcbiAgICBhY2Nlc3NUb2tlbjogJ3BrLmV5SjFJam9pWTJocGJtYzFOaUlzSW1FaU9pSmphWE5pWm1ZeWRHTXdNVE4xTW5wd2JuTnFOV1ZxTTJwbEluMC5rN2gtUFVHWDdUbDV4THdESDNRcHNnJ1xuICB9KS5hZGRUbyhtYXApO1xuICAkKFwiI21hcFwiKS5oaWRlKCk7XG4gICQoXCIjbWFwXCIpLmZhZGVJbigpO1xuXG4gIGNvbnN0IHdlZWtFZ2dMZWdlbmQgPSBMLmNvbnRyb2woe1xuICAgIHBvc2l0aW9uOiAnYm90dG9tcmlnaHQnXG4gIH0pO1xuXG4gIHdlZWtFZ2dMZWdlbmQub25BZGQgPSBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgZGl2ID0gTC5Eb21VdGlsLmNyZWF0ZSgnZGl2JywgJ2luZm8gbGVnZW5kJyksXG4gICAgICBncmFkZXMgPSBbMCwgMSwgNTAsIDEwMCwgMTUwLCAyMDBdO1xuXG4gICAgZGl2LmlubmVySFRNTCArPSAnPHNwYW4gY2xhc3MgPSBcImxlZ2VuZC1oZWFkZXJcIj7mjZXnjbLmlbjvvIjlgIvvvIk8aHI+JztcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGdyYWRlcy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGdyYWRlc1tpXSA9PT0gMCkge1xuICAgICAgICBkaXYuaW5uZXJIVE1MICs9ICc8ZGl2IGNsYXNzPVwiIGJhcnJlbF9sZWdlbmRcIiBpZD1cImdyYWRlXycgKyBpICsgJ1wiPicgKyAnPGkgc3R5bGU9XCJiYWNrZ3JvdW5kOicgKyBnZXRJY29uU3R5bGVSR0JBKGdyYWRlc1tpXSkgKyAnXCI+PC9pPicgKyBncmFkZXNbaV0gKyAnPGJyPjwvZGl2Pic7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkaXYuaW5uZXJIVE1MICs9ICc8ZGl2IGNsYXNzPVwiIGJhcnJlbF9sZWdlbmRcIiBpZD1cImdyYWRlXycgKyBpICsgJ1wiPicgKyAnPGkgc3R5bGU9XCJiYWNrZ3JvdW5kOicgKyBnZXRJY29uU3R5bGVSR0JBKGdyYWRlc1tpXSkgKyAnXCI+PC9pPicgKyBncmFkZXNbaV0gKyAoZ3JhZGVzW2kgKyAxXSA/ICcgJm5kYXNoOyAnICsgKGdyYWRlc1tpICsgMV0gLSAxKSArICc8YnI+PC9kaXY+JyA6ICcgPGJyPjwvZGl2PicpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGRpdi5pbm5lckhUTUwgKz0gJzxkaXYgY2xhc3M9XCIgYmFycmVsX2xlZ2VuZFwiIGlkPVwiZ3JhZGVfb3RoZXJcIj4nICsgJzxpIHN0eWxlPVwiYmFja2dyb3VuZDojY2NjY2NjXCI+PC9pPicgKyAn54Sh6LOH5paZJyArICc8YnI+PC9kaXY+JztcblxuICAgIHJldHVybiBkaXY7XG4gIH07XG5cbiAgd2Vla0VnZ0xlZ2VuZC5hZGRUbyhtYXApO1xuICAkKFwiLmJhcnJlbF9sZWdlbmQgPiBpbnB1dFwiKS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBzZWxlY3RlZENsYXNzID0gJy4nICsgJCh0aGlzKS52YWwoKVxuICAgIGlmICgkKHRoaXMpLnByb3AoXCJjaGVja2VkXCIpKSB7XG4gICAgICAkKHNlbGVjdGVkQ2xhc3MpLmNzcygnZGlzcGxheScsICdibG9jaycpXG4gICAgfSBlbHNlIHtcbiAgICAgICQoc2VsZWN0ZWRDbGFzcykuY3NzKCdkaXNwbGF5JywgJ25vbmUnKVxuICAgIH1cbiAgfSlcbn1cblxuZnVuY3Rpb24gZGF0ZXBpY2tlck9uQ2hhbmdlKCkge1xuICBsZXQgYXZhaWxhYmxlRGF0ZXNJbkludGVydmFsID0gW11cbiAgbGV0IGRhdGFJbkludGVydmFsID0ge31cbiAgY29uc3Qgc3RhcnREYXRlID0gbW9tZW50KCQoJy5yYW5nZS1zdGFydCcpLnZhbCgpKVxuICBjb25zdCBlbmREYXRlID0gbW9tZW50KCQoJy5yYW5nZS1lbmQnKS52YWwoKSlcbiAgY29uc3QgZXZlbnRzID0gZXZlbnRKc29uLnNsaWNlKCkuZmlsdGVyKChkKSA9PiB7XG4gICAgY29uc3QgZXZlbnREYXRlID0gbW9tZW50LnR6KGQuY3JlYXRlZF9hdCwgJ0FzaWEvVGFpcGVpJylcbiAgICByZXR1cm4gZXZlbnREYXRlIDw9IGVuZERhdGUgJiYgZXZlbnREYXRlID49IHN0YXJ0RGF0ZVxuICB9KVxuXG4gIGlmKCBzdGFydERhdGU9PT0nJyB8fCBlbmREYXRlID09PSAnJylcbiAgICByZXR1cm5cblxuICBhdmFpbGFibGVEYXRlcy5mb3JFYWNoKChkKSA9PiB7XG4gICAgbGV0IHRoaXNEYXkgPSBtb21lbnQoZClcbiAgICBpZiAodGhpc0RheSA+PSBzdGFydERhdGUgJiYgdGhpc0RheSA8PSBlbmREYXRlKSB7XG4gICAgICBhdmFpbGFibGVEYXRlc0luSW50ZXJ2YWwucHVzaCh0aGlzRGF5KVxuICAgIH1cbiAgfSlcblxuICBhdmFpbGFibGVEYXRlc0luSW50ZXJ2YWwuZm9yRWFjaCgoZCkgPT4ge1xuICAgIGxldCB0aGlzRGF5S2V5ID0gZC5mb3JtYXQoJ1lZWVktTU0tREQnKVxuICAgIGRhdGFJbkludGVydmFsW3RoaXNEYXlLZXldID0gZ2V0Q291bnQodGhpc0RheUtleSlcbiAgfSlcblxuXG4gIFxuXG4gIGluc2VydEJ1Y2tldExpc3QoZGF0YUluSW50ZXJ2YWwpO1xuICByZW5kZXJFdmVudChldmVudHMpXG59XG5cbmZ1bmN0aW9uIGluc2VydEJ1Y2tldExpc3QoZGF0ZURhdGFNYXApIHtcbiAgY29uc3QgaGFzU3RhcnREYXRlID0gISgkKCcucmFuZ2Utc3RhcnQnKS52YWwoKSA9PT0gJycpXG4gIGNvbnN0IGhhc0VuZERhdGUgPSAhKCQoJy5yYW5nZS1lbmQnKS52YWwoKSA9PT0gJycpXG4gIGNvbnN0IHN0YXJ0RGF0ZSA9IGhhc1N0YXJ0RGF0ZSA/IG1vbWVudCgkKCcucmFuZ2Utc3RhcnQnKS52YWwoKSkuZm9ybWF0KCdZWVlZLU1NLUREJykgOiAn5pyq6YG45pOH6LW35aeL5pel5pyfJ1xuICBjb25zdCBlbmREYXRlID0gaGFzRW5kRGF0ZSA/IG1vbWVudCgkKCcucmFuZ2UtZW5kJykudmFsKCkpLmZvcm1hdCgnWVlZWS1NTS1ERCcpIDogJ+acqumBuOaTh+e1kOadn+aXpeacnydcbiAgY29uc3QgbGFtcFN1bURhdGEgPSB7fVxuICAkKFwiLm1hcC1jb250YWluZXIgLmxpc3QtZ3JvdXBcIikuZW1wdHkoKTtcbiAgY2xlYXJNYXAoKTtcblxuICBpZiAoZ2V0S2V5cyhkYXRlRGF0YU1hcCkubGVuZ3RoID09PSAwKSB7XG4gICAgbGV0IGluZm8gPSAn5rKS5pyJ6LOH5paZJ1xuICAgIGlmICghaGFzRW5kRGF0ZSB8fCAhaGFzU3RhcnREYXRlKSB7XG4gICAgICBpbmZvID0gJydcbiAgICB9XG4gICAgc2V0TWFwVGl0bGUoYCR7c3RhcnREYXRlfSB+ICR7ZW5kRGF0ZX0gJHtpbmZvfWApXG4gIH0gZWxzZSB7XG4gICAgc2V0TWFwVGl0bGUoYCR7c3RhcnREYXRlfSB+ICR7ZW5kRGF0ZX0g5Y2A6ZaT6LOH5paZYClcbiAgfVxuXG4gIGZvciAobGV0IGRhdGUgaW4gZGF0ZURhdGFNYXApIHtcbiAgICBsZXQgdGhpc0RheUNvdW50RGF0YSA9IGRhdGVEYXRhTWFwW2RhdGVdXG4gICAgZm9yIChsZXQgaWQgaW4gdGhpc0RheUNvdW50RGF0YSkge1xuICAgICAgY29uc3QgY291bnQgPSB0aGlzRGF5Q291bnREYXRhW2lkXVxuICAgICAgY29uc3QgbGFtcCA9IGJ1Y2tldEpzb24uZmluZCgoZCkgPT4ge1xuICAgICAgICByZXR1cm4gZC5sYW1wX2lkID09PSBpZFxuICAgICAgfSlcbiAgICAgIGNvbnN0IHBsYWNlID0gZ2V0UGxhY2VOYW1lKGxhbXAucGxhY2VfaWQpXG4gICAgICBpbnNlcnRCdWNrZXRIdG1sKHBsYWNlLCBsYW1wLCBjb3VudCwgZGF0ZSk7XG4gICAgICBpZiAoIWxhbXBTdW1EYXRhW2xhbXAubGFtcF9pZF0pIHtcbiAgICAgICAgbGFtcFN1bURhdGFbbGFtcC5sYW1wX2lkXSA9IHt9XG4gICAgICAgIGxhbXBTdW1EYXRhW2xhbXAubGFtcF9pZF0ubGFtcCA9IGxhbXBcbiAgICAgICAgbGFtcFN1bURhdGFbbGFtcC5sYW1wX2lkXS5jb3VudCA9IDBcbiAgICAgIH1cbiAgICAgIGNvbnN0IGxhbXBDb3VudCA9IGxhbXBTdW1EYXRhW2xhbXAubGFtcF9pZF0uY291bnRcbiAgICAgIGxhbXBTdW1EYXRhW2xhbXAubGFtcF9pZF0uY291bnQgPSBsYW1wQ291bnQgKyBjb3VudFxuICAgIH1cbiAgfVxuICBiaW5kUG9wdXBzKGxhbXBTdW1EYXRhKTtcbiAgJCgnI21hcCcpLmZhZGVJbigpXG59XG5cbmZ1bmN0aW9uIGluc2VydEJ1Y2tldEh0bWwoaW5mbywgYnVja2V0LCBjb3VudCwgZGF0ZSkge1xuICBjb25zdCBpbnNlcnRIVE1MID0gYDxhIGNsYXNzPVwibGlzdC1ncm91cC1pdGVtIFwiPlxuICAgICAgICA8aDQgY2xhc3M9XCJsaXN0LWdyb3VwLWl0ZW0taGVhZGluZ1wiPjxzcGFuPiR7YnVja2V0LmxhbXBfaWR9QCR7aW5mb308L3NwYW4+PHNwYW4+JiM5ODg5OyR7Y291bnR9PC9zcGFuPjwvaDQ+XG4gICAgICAgIDxwIGNsYXNzPVwibGlzdC1ncm91cC1pdGVtLXRleHRcIj4gJHttb21lbnQoZGF0ZSkuZm9ybWF0KCdMTCcpfTwvcD5cbiAgICAgIDwvYT5gXG4gICQoXCIubWFwLWNvbnRhaW5lciAubGlzdC1ncm91cFwiKS5hcHBlbmQoaW5zZXJ0SFRNTCk7XG59XG5cbmZ1bmN0aW9uIGdldEtleXMob2JqKSB7XG4gIHRyeSB7XG4gICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKG9iaik7XG4gICAgcmV0dXJuIGtleXM7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIHJldHVybiBbXTtcbiAgfVxufVxuXG5mdW5jdGlvbiBzZXRNYXBUaXRsZShtYXBUaXRsZSkge1xuICAvLyBjbGVhciBsb2FkaW5nIHRleHQgXG4gIGNvbnN0IHRpdGxlID0gJChgPGgzPiR7bWFwVGl0bGV9PC9oMz5gKVxuICAkKCcubGlzdC1ncm91cCcpLmVtcHR5KClcbiAgJCgnLmxpc3QtZ3JvdXAnKS5hcHBlbmQodGl0bGUpXG4gIFxuICB0aXRsZS5oaWRlKCk7XG4gIHRpdGxlLmZhZGVJbignc2xvdycpO1xufVxuXG5mdW5jdGlvbiByZW5kZXJFdmVudChldmVudHMpIHtcbiAgZXZlbnRzLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgY29uc3QgbGF0bG5nID0gW2V2ZW50Lm1jY19jZW50ZXJbMV0sIGV2ZW50Lm1jY19jZW50ZXJbMF1dXG4gICAgY29uc3QgcmFkaXVzID0gbWNjRGlzdGFuY2VMb3dlckxpbWl0XG4gICAgY29uc3QgY2lyY2xlID0gTC5jaXJjbGUobGF0bG5nLCB7XG4gICAgICByYWRpdXM6IHJhZGl1c1xuICAgIH0pXG4gICAgY2lyY2xlcy5wdXNoKGNpcmNsZSlcbiAgICBjaXJjbGUuYWRkVG8obWFwKTtcbiAgfSlcbn1cblxuZnVuY3Rpb24gY2xlYXJNYXAoKSB7XG4gIG1hcmtlckFycmF5LmZvckVhY2goZnVuY3Rpb24gKG1hcmtlcikge1xuICAgIG1hcC5yZW1vdmVMYXllcihtYXJrZXIpO1xuICB9KTtcblxuICBjaXJjbGVzLmZvckVhY2goZnVuY3Rpb24gKGNpcmNsZSkge1xuICAgIGNpcmNsZS5yZW1vdmUoKVxuICB9KVxuXG4gIGNpcmNsZXMgPSBbXVxuXG4gICQoXCIjbWFwXCIpLmhpZGUoKTtcbn1cblxuZnVuY3Rpb24gYmluZFBvcHVwcyhsYW1wU3VtRGF0YSkge1xuXG4gIGNvbnN0IFNDQUxFID0gODA7XG5cbiAgZm9yKCBsZXQgaWQgaW4gbGFtcFN1bURhdGEgKXtcbiAgICBjb25zb2xlLmxvZyhsYW1wU3VtRGF0YSlcbiAgICBjb25zdCBsYW1wID0gbGFtcFN1bURhdGFbaWRdLmxhbXBcbiAgICBjb25zdCBjb3VudCA9IGxhbXBTdW1EYXRhW2lkXS5jb3VudFxuICAgIGNvbnN0IGxhdCA9IGxhbXAubGFtcF9sb2NhdGlvblsxXVxuICAgIGNvbnN0IGxuZyA9IGxhbXAubGFtcF9sb2NhdGlvblswXVxuICAgIGNvbnN0IGljb24gPSBMLmljb24oe1xuICAgICAgaWNvblVybDogZ2V0SWNvblN0eWxlKGNvdW50KSxcbiAgICAgIGljb25TaXplOiBbNDUsIDgwXSwgLy8gc2l6ZSBvZiB0aGUgaWNvblxuICAgICAgcG9wdXBBbmNob3I6IFswLCAtNDBdLFxuICAgICAgaWNvbkFuY2hvcjogWzIyLCA2MF0sXG4gICAgICBjbGFzc05hbWU6IGdldEljb25DYXQoY291bnQpLFxuICAgIH0pO1xuICAgIGNvbnN0IFBvcFVwQ29udGVudCA9IChgPHRhYmxlPlxuICAgICAgPHRyPlxuICAgICAgICA8dGg+IElEIDwvdGg+XG4gICAgICAgIDx0ZD4gJHtsYW1wLmxhbXBfaWR9IDwvdGQ+XG4gICAgICA8L3RyPlxuICAgICAgPHRyPlxuICAgICAgICA8dGg+5Zyw6buePC90aD5cbiAgICAgICAgPHRkPiR7Z2V0UGxhY2VOYW1lKGxhbXAucGxhY2VfaWQpfTwvdGQ+XG4gICAgICA8L3RyPlxuICAgICAgICA8dHI+XG4gICAgICAgIDx0aD7mjZXnjbI8L3RoPlxuICAgICAgICA8dGQ+JHtjb3VudH08L3RkPlxuICAgICAgPC90cj5cbiAgICAgIDwvdGFibGU+YClcbiAgICBjb25zdCBtYXJrZXIgPSBMLm1hcmtlcihbbGF0LCBsbmddLCB7XG4gICAgICBpY29uOiBpY29uXG4gICAgfSkuYmluZFBvcHVwKFBvcFVwQ29udGVudCkuYWRkVG8obWFwKTtcbiAgICBtYXJrZXJBcnJheS5wdXNoKG1hcmtlcik7XG4gIH1cbiAgaWYoIG1hcmtlckFycmF5Lmxlbmd0aCA+IDApe1xuICAgIGNvbnN0IGdyb3VwID0gbmV3IEwuZmVhdHVyZUdyb3VwKG1hcmtlckFycmF5KTtcbiAgICBtYXAuZml0Qm91bmRzKGdyb3VwLmdldEJvdW5kcygpKTtcbiAgfSBcbn1cblxuZnVuY3Rpb24gZ2V0SWNvblN0eWxlKGFtb3VudCkge1xuICBsZXQgc3R5bGU7XG4gIGlmIChhbW91bnQgPT09IDApIHtcbiAgICBzdHlsZSA9ICdsZWdlbmQxJztcbiAgfSBlbHNlIGlmIChhbW91bnQgPiAwICYmIGFtb3VudCA8PSA0OSkge1xuICAgIHN0eWxlID0gJ2xlZ2VuZDInO1xuICB9IGVsc2UgaWYgKGFtb3VudCA+PSA1MCAmJiBhbW91bnQgPD0gOTkpIHtcbiAgICBzdHlsZSA9ICdsZWdlbmQzJztcbiAgfSBlbHNlIGlmIChhbW91bnQgPj0gMTAwICYmIGFtb3VudCA8PSAxNDkpIHtcbiAgICBzdHlsZSA9ICdsZWdlbmQ0JztcbiAgfSBlbHNlIGlmIChhbW91bnQgPj0gMTUwICYmIGFtb3VudCA8PSAxOTkpIHtcbiAgICBzdHlsZSA9ICdsZWdlbmQ1JztcbiAgfSBlbHNlIGlmIChhbW91bnQgPj0gMjAwKSB7XG4gICAgc3R5bGUgPSAnbGVnZW5kNic7XG4gIH0gZWxzZSB7XG4gICAgc3R5bGUgPSAnbGVnZW5kX3VuZGVmaW5lZCc7XG4gIH1cbiAgcmV0dXJuICdpbWFnZXMvJyArIHN0eWxlICsgJy5zdmcnO1xufVxuXG5mdW5jdGlvbiBnZXRJY29uQ2F0KGFtb3VudCkge1xuICBsZXQgY2F0ZWdvcnk7XG4gIGlmIChhbW91bnQgPT09IDApIHtcbiAgICBjYXRlZ29yeSA9ICdncmFkZV8wJztcbiAgfSBlbHNlIGlmIChhbW91bnQgPiAwICYmIGFtb3VudCA8PSA0OSkge1xuICAgIGNhdGVnb3J5ID0gJ2dyYWRlXzEnO1xuICB9IGVsc2UgaWYgKGFtb3VudCA+PSA1MCAmJiBhbW91bnQgPD0gOTkpIHtcbiAgICBjYXRlZ29yeSA9ICdncmFkZV8yJztcbiAgfSBlbHNlIGlmIChhbW91bnQgPj0gMTAwICYmIGFtb3VudCA8PSAxNDkpIHtcbiAgICBjYXRlZ29yeSA9ICdncmFkZV8zJztcbiAgfSBlbHNlIGlmIChhbW91bnQgPj0gMTUwICYmIGFtb3VudCA8PSAxOTkpIHtcbiAgICBjYXRlZ29yeSA9ICdncmFkZV80JztcbiAgfSBlbHNlIGlmIChhbW91bnQgPj0gMjAwKSB7XG4gICAgY2F0ZWdvcnkgPSAnZ3JhZGVfNSc7XG4gIH0gZWxzZSB7XG4gICAgY2F0ZWdvcnkgPSAnZ3JhZGVfb3RoZXInO1xuICB9XG4gIHJldHVybiBjYXRlZ29yeTtcbn1cblxuZnVuY3Rpb24gZ2V0SWNvblN0eWxlUkdCQShhbW91bnQpIHtcbiAgbGV0IHN0eWxlO1xuICBpZiAoYW1vdW50ID09PSAwKSB7XG4gICAgc3R5bGUgPSAnIzAwRkY5RCc7XG4gIH0gZWxzZSBpZiAoYW1vdW50ID4gMCAmJiBhbW91bnQgPD0gNDkpIHtcbiAgICBzdHlsZSA9ICcjMzNDQzdFJztcbiAgfSBlbHNlIGlmIChhbW91bnQgPj0gNTAgJiYgYW1vdW50IDw9IDk5KSB7XG4gICAgc3R5bGUgPSAnIzY2OTk1RSc7XG4gIH0gZWxzZSBpZiAoYW1vdW50ID49IDEwMCAmJiBhbW91bnQgPD0gMTQ5KSB7XG4gICAgc3R5bGUgPSAnIzk5NjYzRic7XG4gIH0gZWxzZSBpZiAoYW1vdW50ID49IDE1MCAmJiBhbW91bnQgPD0gMTk5KSB7XG4gICAgc3R5bGUgPSAnI0NDMzMxRic7XG4gIH0gZWxzZSBpZiAoYW1vdW50ID49IDIwMCkge1xuICAgIHN0eWxlID0gJyNGRjAwMDAnO1xuICB9XG5cbiAgcmV0dXJuIHN0eWxlO1xufSJdfQ==\n"]}