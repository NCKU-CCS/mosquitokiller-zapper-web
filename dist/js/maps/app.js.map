{"version":3,"sources":["app.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","initMap","map","L","setView","countryView","tileLayer","attribution","maxZoom","id","accessToken","addTo","$","hide","fadeIn","weekEggLegend","control","position","onAdd","div","DomUtil","create","grades","innerHTML","getIconStyleRGBA","on","selectedClass","this","val","prop","css","datepickerOnChange","availableDatesInInterval","dataInInterval","startDate","moment","endDate","events","eventJson","slice","filter","d","eventDate","tz","created_at","availableDates","forEach","thisDay","push","thisDayKey","format","getCount","insertBucketList","renderEvent","dateDataMap","hasStartDate","hasEndDate","empty","clearMap","getKeys","info","setMapTitle","date","thisDayCountData","count","lamp","bucketJson","find","lamp_id","insertBucketHtml","getPlaceName","place_id","bindPopups","_loop","bucket","insertHTML","updated_at","append","obj","Object","keys","err","mapTitle","console","log","title","event","latlng","mcc_center","radius","mccDistanceLowerLimit","circle","circles","markerArray","marker","removeLayer","remove","lat","lamp_location","lng","icon","iconUrl","getIconStyle","iconSize","popupAnchor","iconAnchor","className","getIconCat","PopUpContent","bindPopup","amount","style","String","prototype","args","arguments","replace","match","number","countJson","placeJson","locale","getPlaceNameFunc","placeMap","place_name","getCountFunc","countMap","dateData","sum","台南","高雄","屏東","document","ready","datepicker","autoclose","zIndexOffset","reqPromises","url","ajax","dataType","type","Promise","all","then","res","distance_lower_limit"],"mappings":"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","file":"../app.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\nif (!String.prototype.format) {\n  String.prototype.format = function () {\n    var args = arguments;\n    return this.replace(/{(\\d+)}/g, function (match, number) {\n      return typeof args[number] !== 'undefined' ? args[number] : match;\n    });\n  };\n}\n\nvar bucketJson = {};\nvar eventJson = {};\nvar locationJson = {};\nvar countJson = {};\nvar placeJson = {};\nvar mccDistanceLowerLimit = void 0;\nvar map = void 0;\nvar markerArray = [];\nvar circles = [];\nvar getPlaceName = void 0;\nvar getCount = void 0;\nvar availableDates = void 0;\n\nmoment.locale('zh-tw');\n\nvar getPlaceNameFunc = function getPlaceNameFunc(placeJson) {\n  var placeMap = {};\n  placeJson.forEach(function (d) {\n    placeMap[d.place_id] = d.place_name;\n  });\n  return function (id) {\n    return placeMap[id];\n  };\n};\n\nvar getCountFunc = function getCountFunc(countJson) {\n  var countMap = {};\n  availableDates.forEach(function (d) {\n    countMap[d] = {};\n  });\n  for (var i in countJson) {\n    var dateData = countJson[i];\n    for (var id in dateData) {\n      countMap[i][id] = dateData[id].sum;\n    }\n  }\n  return function (date) {\n    return countMap[date];\n  };\n};\nvar countryView = {\n  '台南': [22.9971, 120.1926],\n  '高雄': [22.6397615, 120.2999183],\n  '屏東': [22.667431, 120.486307]\n};\n\n$(document).ready(function () {\n  setMapTitle('資料載入中...');\n  $('.range-start').datepicker({\n    'autoclose': true,\n    'zIndexOffset': 1000,\n    'format': 'yyyy-mm-dd'\n  }).on('changeDate', datepickerOnChange);\n  $('.range-end').datepicker({\n    'autoclose': true,\n    'zIndexOffset': 1000,\n    'format': 'yyyy-mm-dd'\n  }).on('changeDate', datepickerOnChange);\n\n  var root_url = 'http://140.116.249.228:3000/apis/';\n  var urls = ['lamps', 'rules', 'mcc', 'counts', 'places'];\n  var reqPromises = urls.map(function (url) {\n    return $.ajax({\n      // url: root_url + url,\n      url: url + '.json',\n      dataType: \"JSON\",\n      type: \"GET\"\n    });\n  });\n\n  Promise.all(reqPromises).then(function (res) {\n    bucketJson = res[0]['lamps'];\n    mccDistanceLowerLimit = res[1]['rules'][0].distance_lower_limit;\n    eventJson = res[2]['mcc'];\n    countJson = res[3]['counts'];\n    placeJson = res[4]['places'];\n\n    console.log(res);\n\n    availableDates = getKeys(countJson);\n    getPlaceName = getPlaceNameFunc(placeJson);\n    getCount = getCountFunc(countJson);\n    initMap();\n    setMapTitle('請選擇日期區間');\n  });\n});\n\nfunction initMap() {\n  map = L.map('map').setView(countryView[\"台南\"], 14);\n\n  L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/dark-v9/tiles/256/{z}/{x}/{y}?access_token={accessToken}', {\n    attribution: 'Map data &copy; <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, Imagery © <a href=\"http://mapbox.com\">Mapbox</a>',\n    maxZoom: 18,\n    id: 'ching56.17hng6ja',\n    accessToken: 'pk.eyJ1IjoiY2hpbmc1NiIsImEiOiJjaXNiZmYydGMwMTN1MnpwbnNqNWVqM2plIn0.k7h-PUGX7Tl5xLwDH3Qpsg'\n  }).addTo(map);\n  $(\"#map\").hide();\n  $(\"#map\").fadeIn();\n\n  var weekEggLegend = L.control({\n    position: 'bottomright'\n  });\n\n  weekEggLegend.onAdd = function () {\n    var div = L.DomUtil.create('div', 'info legend'),\n        grades = [0, 1, 50, 100, 150, 200];\n\n    div.innerHTML += '<span class = \"legend-header\">捕獲數（個）<hr>';\n    for (var i = 0; i < grades.length; i++) {\n      if (grades[i] === 0) {\n        div.innerHTML += '<div class=\" barrel_legend\" id=\"grade_' + i + '\">' + '<i style=\"background:' + getIconStyleRGBA(grades[i]) + '\"></i>' + grades[i] + '<br></div>';\n      } else {\n        div.innerHTML += '<div class=\" barrel_legend\" id=\"grade_' + i + '\">' + '<i style=\"background:' + getIconStyleRGBA(grades[i]) + '\"></i>' + grades[i] + (grades[i + 1] ? ' &ndash; ' + (grades[i + 1] - 1) + '<br></div>' : ' <br></div>');\n      }\n    }\n\n    div.innerHTML += '<div class=\" barrel_legend\" id=\"grade_other\">' + '<i style=\"background:#cccccc\"></i>' + '無資料' + '<br></div>';\n\n    return div;\n  };\n\n  weekEggLegend.addTo(map);\n  $(\".barrel_legend > input\").on(\"click\", function () {\n    var selectedClass = '.' + $(this).val();\n    if ($(this).prop(\"checked\")) {\n      $(selectedClass).css('display', 'block');\n    } else {\n      $(selectedClass).css('display', 'none');\n    }\n  });\n}\n\nfunction datepickerOnChange() {\n  var availableDatesInInterval = [];\n  var dataInInterval = {};\n  var startDate = moment($('.range-start').val());\n  var endDate = moment($('.range-end').val());\n  var events = eventJson.slice().filter(function (d) {\n    var eventDate = moment.tz(d.created_at, 'Asia/Taipei');\n    return eventDate <= endDate && eventDate >= startDate;\n  });\n\n  if (startDate === '' || endDate === '') return;\n\n  availableDates.forEach(function (d) {\n    var thisDay = moment(d);\n    if (thisDay >= startDate && thisDay <= endDate) {\n      availableDatesInInterval.push(thisDay);\n    }\n  });\n\n  availableDatesInInterval.forEach(function (d) {\n    var thisDayKey = d.format('YYYY-MM-DD');\n    dataInInterval[thisDayKey] = getCount(thisDayKey);\n  });\n\n  insertBucketList(dataInInterval);\n  renderEvent(events);\n}\n\nfunction insertBucketList(dateDataMap) {\n  var hasStartDate = !($('.range-start').val() === '');\n  var hasEndDate = !($('.range-end').val() === '');\n  var startDate = hasStartDate ? moment($('.range-start').val()).format('YYYY-MM-DD') : '未選擇起始日期';\n  var endDate = hasEndDate ? moment($('.range-end').val()).format('YYYY-MM-DD') : '未選擇結束日期';\n  $(\".map-container .list-group\").empty();\n  clearMap();\n\n  if (getKeys(dateDataMap).length === 0) {\n    var info = '沒有資料';\n    if (!hasEndDate || !hasStartDate) {\n      info = '';\n    }\n    setMapTitle(startDate + ' ~ ' + endDate + ' ' + info);\n  } else {\n    setMapTitle(startDate + ' ~ ' + endDate + ' \\u5340\\u9593\\u8CC7\\u6599');\n  }\n\n  for (var date in dateDataMap) {\n    var thisDayCountData = dateDataMap[date];\n\n    var _loop = function _loop(id) {\n      var count = thisDayCountData[id];\n      var lamp = bucketJson.find(function (d) {\n        return d.lamp_id === id;\n      });\n      var place = getPlaceName(lamp.place_id);\n      insertBucketHtml(place, lamp, count);\n      bindPopups(lamp, count);\n    };\n\n    for (var id in thisDayCountData) {\n      _loop(id);\n    }\n  }\n\n  $('#map').fadeIn();\n}\n\nfunction insertBucketHtml(info, bucket, count) {\n  var insertHTML = '<a class=\"list-group-item \">\\n        <h4 class=\"list-group-item-heading\"><span>' + bucket.lamp_id + '@' + info + '</span><span>&#9889;' + count + '</span></h4>\\n        <p class=\"list-group-item-text\"> ' + moment.tz(bucket.updated_at, 'Asia/Taipei').format('LLL') + '</p>\\n      </a>';\n  $(\".map-container .list-group\").append(insertHTML);\n}\n\nfunction getKeys(obj) {\n  try {\n    var keys = Object.keys(obj);\n    return keys;\n  } catch (err) {\n    return [];\n  }\n}\n\nfunction setMapTitle(mapTitle) {\n  // clear loading text \n  console.log('set title', mapTitle);\n  var title = $('<h3>' + mapTitle + '</h3>');\n  $('.list-group').empty();\n  $('.list-group').append(title);\n\n  title.hide();\n  title.fadeIn('slow');\n}\n\nfunction renderEvent(events) {\n  events.forEach(function (event) {\n    var latlng = [event.mcc_center[1], event.mcc_center[0]];\n    var radius = mccDistanceLowerLimit;\n    var circle = L.circle(latlng, {\n      radius: radius\n    });\n    circles.push(circle);\n    circle.addTo(map);\n  });\n}\n\nfunction clearMap() {\n  markerArray.forEach(function (marker) {\n    map.removeLayer(marker);\n  });\n\n  circles.forEach(function (circle) {\n    circle.remove();\n  });\n\n  circles = [];\n\n  $(\"#map\").hide();\n}\n\nfunction bindPopups(lamp, count) {\n\n  var SCALE = 80;\n\n  var lat = lamp.lamp_location[1];\n  var lng = lamp.lamp_location[0];\n\n  var icon = L.icon({\n    iconUrl: getIconStyle(count),\n    iconSize: [45, 80], // size of the icon\n    popupAnchor: [0, -40],\n    iconAnchor: [22, 60],\n    className: getIconCat(count)\n  });\n\n  var PopUpContent = ('<table>' + '<tr>' + '<th> ID </th>' + '<td> {0} </td>' + '</tr>' + '<tr>' + '<th>地點</th>' + '<td>{1}</td>' + '</tr>' + '<tr>' + '<th>捕獲</th>' + '<td>{2}</td>' + '</tr>' + '</table>').format(lamp.lamp_id, getPlaceName(lamp.place_id), count);\n\n  var marker = L.marker([lat, lng], {\n    icon: icon\n  }).bindPopup(PopUpContent).addTo(map);\n  markerArray.push(marker);\n}\n\nfunction getIconStyle(amount) {\n  var style;\n  if (amount === 0) {\n    style = 'legend1';\n  } else if (amount > 0 && amount <= 49) {\n    style = 'legend2';\n  } else if (amount >= 50 && amount <= 99) {\n    style = 'legend3';\n  } else if (amount >= 100 && amount <= 149) {\n    style = 'legend4';\n  } else if (amount >= 150 && amount <= 199) {\n    style = 'legend5';\n  } else if (amount >= 200) {\n    style = 'legend6';\n  } else {\n    style = 'legend_undefined';\n  }\n  return 'images/' + style + '.svg';\n}\n\nfunction getIconCat(amount) {\n  var category;\n  if (amount === 0) {\n    category = 'grade_0';\n  } else if (amount > 0 && amount <= 49) {\n    category = 'grade_1';\n  } else if (amount >= 50 && amount <= 99) {\n    category = 'grade_2';\n  } else if (amount >= 100 && amount <= 149) {\n    category = 'grade_3';\n  } else if (amount >= 150 && amount <= 199) {\n    category = 'grade_4';\n  } else if (amount >= 200) {\n    category = 'grade_5';\n  } else {\n    category = 'grade_other';\n  }\n  return category;\n}\n\nfunction getIconStyleRGBA(amount) {\n  var style;\n  if (amount === 0) {\n    style = '#00FF9D';\n  } else if (amount > 0 && amount <= 49) {\n    style = '#33CC7E';\n  } else if (amount >= 50 && amount <= 99) {\n    style = '#66995E';\n  } else if (amount >= 100 && amount <= 149) {\n    style = '#99663F';\n  } else if (amount >= 150 && amount <= 199) {\n    style = '#CC331F';\n  } else if (amount >= 200) {\n    style = '#FF0000';\n  }\n\n  return style;\n}\n\n},{}]},{},[1])\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYXBwLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNBQSxJQUFJLENBQUMsT0FBTyxTQUFQLENBQWlCLE1BQXRCLEVBQThCO0FBQzVCLFNBQU8sU0FBUCxDQUFpQixNQUFqQixHQUEwQixZQUFZO0FBQ3BDLFFBQU0sT0FBTyxTQUFiO0FBQ0EsV0FBTyxLQUFLLE9BQUwsQ0FBYSxVQUFiLEVBQXlCLFVBQVUsS0FBVixFQUFpQixNQUFqQixFQUF5QjtBQUN2RCxhQUFPLE9BQU8sS0FBSyxNQUFMLENBQVAsS0FBd0IsV0FBeEIsR0FBc0MsS0FBSyxNQUFMLENBQXRDLEdBQXFELEtBQTVEO0FBQ0QsS0FGTSxDQUFQO0FBR0QsR0FMRDtBQU1EOztBQUVELElBQUksYUFBYSxFQUFqQjtBQUNBLElBQUksWUFBWSxFQUFoQjtBQUNBLElBQUksZUFBZSxFQUFuQjtBQUNBLElBQUksWUFBWSxFQUFoQjtBQUNBLElBQUksWUFBWSxFQUFoQjtBQUNBLElBQUksOEJBQUo7QUFDQSxJQUFJLFlBQUo7QUFDQSxJQUFJLGNBQWMsRUFBbEI7QUFDQSxJQUFJLFVBQVUsRUFBZDtBQUNBLElBQUkscUJBQUo7QUFDQSxJQUFJLGlCQUFKO0FBQ0EsSUFBSSx1QkFBSjs7QUFFQSxPQUFPLE1BQVAsQ0FBYyxPQUFkOztBQUVBLElBQUksbUJBQW1CLFNBQW5CLGdCQUFtQixDQUFVLFNBQVYsRUFBcUI7QUFDMUMsTUFBSSxXQUFXLEVBQWY7QUFDQSxZQUFVLE9BQVYsQ0FBa0IsVUFBVSxDQUFWLEVBQWE7QUFDN0IsYUFBUyxFQUFFLFFBQVgsSUFBdUIsRUFBRSxVQUF6QjtBQUNELEdBRkQ7QUFHQSxTQUFPLFVBQVUsRUFBVixFQUFjO0FBQ25CLFdBQU8sU0FBUyxFQUFULENBQVA7QUFDRCxHQUZEO0FBR0QsQ0FSRDs7QUFVQSxJQUFJLGVBQWUsU0FB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TUFFQSxJQUFJLFVBQVUsRUFBVixJQUFnQixVQUFVLEVBQTlCLEVBQWtDO0FBQ3ZDLGVBQVcsU0FBWDtBQUNELEdBRk0sTUFFQSxJQUFJLFVBQVUsR0FBVixJQUFpQixVQUFVLEdBQS9CLEVBQW9DO0FBQ3pDLGVBQVcsU0FBWDtBQUNELEdBRk0sTUFFQSxJQUFJLFVBQVUsR0FBVixJQUFpQixVQUFVLEdBQS9CLEVBQW9DO0FBQ3pDLGVBQVcsU0FBWDtBQUNELEdBRk0sTUFFQSxJQUFJLFVBQVUsR0FBZCxFQUFtQjtBQUN4QixlQUFXLFNBQVg7QUFDRCxHQUZNLE1BRUE7QUFDTCxlQUFXLGFBQVg7QUFDRDtBQUNELFNBQU8sUUFBUDtBQUNEOztBQUVELFNBQVMsZ0JBQVQsQ0FBMEIsTUFBMUIsRUFBa0M7QUFDaEMsTUFBSSxLQUFKO0FBQ0EsTUFBSSxXQUFXLENBQWYsRUFBa0I7QUFDaEIsWUFBUSxTQUFSO0FBQ0QsR0FGRCxNQUVPLElBQUksU0FBUyxDQUFULElBQWMsVUFBVSxFQUE1QixFQUFnQztBQUNyQyxZQUFRLFNBQVI7QUFDRCxHQUZNLE1BRUEsSUFBSSxVQUFVLEVBQVYsSUFBZ0IsVUFBVSxFQUE5QixFQUFrQztBQUN2QyxZQUFRLFNBQVI7QUFDRCxHQUZNLE1BRUEsSUFBSSxVQUFVLEdBQVYsSUFBaUIsVUFBVSxHQUEvQixFQUFvQztBQUN6QyxZQUFRLFNBQVI7QUFDRCxHQUZNLE1BRUEsSUFBSSxVQUFVLEdBQVYsSUFBaUIsVUFBVSxHQUEvQixFQUFvQztBQUN6QyxZQUFRLFNBQVI7QUFDRCxHQUZNLE1BRUEsSUFBSSxVQUFVLEdBQWQsRUFBbUI7QUFDeEIsWUFBUSxTQUFSO0FBQ0Q7O0FBRUQsU0FBTyxLQUFQO0FBQ0QiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiaWYgKCFTdHJpbmcucHJvdG90eXBlLmZvcm1hdCkge1xuICBTdHJpbmcucHJvdG90eXBlLmZvcm1hdCA9IGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBhcmdzID0gYXJndW1lbnRzO1xuICAgIHJldHVybiB0aGlzLnJlcGxhY2UoL3soXFxkKyl9L2csIGZ1bmN0aW9uIChtYXRjaCwgbnVtYmVyKSB7XG4gICAgICByZXR1cm4gdHlwZW9mIGFyZ3NbbnVtYmVyXSAhPT0gJ3VuZGVmaW5lZCcgPyBhcmdzW251bWJlcl0gOiBtYXRjaDtcbiAgICB9KVxuICB9O1xufVxuXG5sZXQgYnVja2V0SnNvbiA9IHt9XG5sZXQgZXZlbnRKc29uID0ge31cbmxldCBsb2NhdGlvbkpzb24gPSB7fVxubGV0IGNvdW50SnNvbiA9IHt9XG5sZXQgcGxhY2VKc29uID0ge31cbmxldCBtY2NEaXN0YW5jZUxvd2VyTGltaXRcbmxldCBtYXA7XG5sZXQgbWFya2VyQXJyYXkgPSBbXTtcbmxldCBjaXJjbGVzID0gW11cbmxldCBnZXRQbGFjZU5hbWVcbmxldCBnZXRDb3VudFxubGV0IGF2YWlsYWJsZURhdGVzXG5cbm1vbWVudC5sb2NhbGUoJ3poLXR3JylcblxubGV0IGdldFBsYWNlTmFtZUZ1bmMgPSBmdW5jdGlvbiAocGxhY2VKc29uKSB7XG4gIHZhciBwbGFjZU1hcCA9IHt9XG4gIHBsYWNlSnNvbi5mb3JFYWNoKGZ1bmN0aW9uIChkKSB7XG4gICAgcGxhY2VNYXBbZC5wbGFjZV9pZF0gPSBkLnBsYWNlX25hbWVcbiAgfSlcbiAgcmV0dXJuIGZ1bmN0aW9uIChpZCkge1xuICAgIHJldHVybiBwbGFjZU1hcFtpZF1cbiAgfVxufVxuXG52YXIgZ2V0Q291bnRGdW5jID0gKGNvdW50SnNvbikgPT4ge1xuICBsZXQgY291bnRNYXAgPSB7fVxuICBhdmFpbGFibGVEYXRlcy5mb3JFYWNoKChkKSA9PiB7XG4gICAgY291bnRNYXBbZF0gPSB7fVxuICB9KVxuICBmb3IgKGxldCBpIGluIGNvdW50SnNvbikge1xuICAgIGxldCBkYXRlRGF0YSA9IGNvdW50SnNvbltpXVxuICAgIGZvciAobGV0IGlkIGluIGRhdGVEYXRhKVxuICAgICAgY291bnRNYXBbaV1baWRdID0gZGF0ZURhdGFbaWRdLnN1bVxuICB9XG4gIHJldHVybiAoZGF0ZSkgPT4ge1xuICAgIHJldHVybiBjb3VudE1hcFtkYXRlXVxuICB9XG59XG52YXIgY291bnRyeVZpZXcgPSB7XG4gICflj7DljZcnOiBbMjIuOTk3MSwgMTIwLjE5MjZdLFxuICAn6auY6ZuEJzogWzIyLjYzOTc2MTUsIDEyMC4yOTk5MTgzXSxcbiAgJ+Wxj+adsSc6IFsyMi42Njc0MzEsIDEyMC40ODYzMDddXG59XG5cbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgc2V0TWFwVGl0bGUoJ+izh+aWmei8ieWFpeS4rS4uLicpXG4gICQoJy5yYW5nZS1zdGFydCcpLmRhdGVwaWNrZXIoe1xuICAgICdhdXRvY2xvc2UnOiB0cnVlLFxuICAgICd6SW5kZXhPZmZzZXQnOiAxMDAwLFxuICAgICdmb3JtYXQnOiAneXl5eS1tbS1kZCdcbiAgfSkub24oJ2NoYW5nZURhdGUnLCBkYXRlcGlja2VyT25DaGFuZ2UpXG4gICQoJy5yYW5nZS1lbmQnKS5kYXRlcGlja2VyKHtcbiAgICAnYXV0b2Nsb3NlJzogdHJ1ZSxcbiAgICAnekluZGV4T2Zmc2V0JzogMTAwMCxcbiAgICAnZm9ybWF0JzogJ3l5eXktbW0tZGQnXG4gIH0pLm9uKCdjaGFuZ2VEYXRlJywgZGF0ZXBpY2tlck9uQ2hhbmdlKVxuXG4gIHZhciByb290X3VybCA9ICdodHRwOi8vMTQwLjExNi4yNDkuMjI4OjMwMDAvYXBpcy8nXG4gIHZhciB1cmxzID0gWydsYW1wcycsICdydWxlcycsICdtY2MnLCAnY291bnRzJywgJ3BsYWNlcyddO1xuICB2YXIgcmVxUHJvbWlzZXMgPSB1cmxzLm1hcChmdW5jdGlvbiAodXJsKSB7XG4gICAgcmV0dXJuICQuYWpheCh7XG4gICAgICAvLyB1cmw6IHJvb3RfdXJsICsgdXJsLFxuICAgICAgdXJsOiB1cmwgKyAnLmpzb24nLFxuICAgICAgZGF0YVR5cGU6IFwiSlNPTlwiLFxuICAgICAgdHlwZTogXCJHRVRcIlxuICAgIH0pO1xuICB9KTtcblxuICBQcm9taXNlLmFsbChyZXFQcm9taXNlcykudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgYnVja2V0SnNvbiA9IHJlc1swXVsnbGFtcHMnXVxuICAgIG1jY0Rpc3RhbmNlTG93ZXJMaW1pdCA9IHJlc1sxXVsncnVsZXMnXVswXS5kaXN0YW5jZV9sb3dlcl9saW1pdFxuICAgIGV2ZW50SnNvbiA9IHJlc1syXVsnbWNjJ11cbiAgICBjb3VudEpzb24gPSByZXNbM11bJ2NvdW50cyddXG4gICAgcGxhY2VKc29uID0gcmVzWzRdWydwbGFjZXMnXVxuXG4gICAgY29uc29sZS5sb2cocmVzKVxuXG4gICAgYXZhaWxhYmxlRGF0ZXMgPSBnZXRLZXlzKGNvdW50SnNvbilcbiAgICBnZXRQbGFjZU5hbWUgPSBnZXRQbGFjZU5hbWVGdW5jKHBsYWNlSnNvbilcbiAgICBnZXRDb3VudCA9IGdldENvdW50RnVuYyhjb3VudEpzb24pXG4gICAgaW5pdE1hcCgpO1xuICAgIHNldE1hcFRpdGxlKCfoq4vpgbjmk4fml6XmnJ/ljYDplpMnKVxuICB9KVxufSk7XG5cbmZ1bmN0aW9uIGluaXRNYXAoKSB7XG4gIG1hcCA9IEwubWFwKCdtYXAnKS5zZXRWaWV3KGNvdW50cnlWaWV3W1wi5Y+w5Y2XXCJdLCAxNClcblxuICBMLnRpbGVMYXllcignaHR0cHM6Ly9hcGkubWFwYm94LmNvbS9zdHlsZXMvdjEvbWFwYm94L2RhcmstdjkvdGlsZXMvMjU2L3t6fS97eH0ve3l9P2FjY2Vzc190b2tlbj17YWNjZXNzVG9rZW59Jywge1xuICAgIGF0dHJpYnV0aW9uOiAnTWFwIGRhdGEgJmNvcHk7IDxhIGhyZWY9XCJodHRwOi8vb3BlbnN0cmVldG1hcC5vcmdcIj5PcGVuU3RyZWV0TWFwPC9hPiBjb250cmlidXRvcnMsIDxhIGhyZWY9XCJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS1zYS8yLjAvXCI+Q0MtQlktU0E8L2E+LCBJbWFnZXJ5IMKpIDxhIGhyZWY9XCJodHRwOi8vbWFwYm94LmNvbVwiPk1hcGJveDwvYT4nLFxuICAgIG1heFpvb206IDE4LFxuICAgIGlkOiAnY2hpbmc1Ni4xN2huZzZqYScsXG4gICAgYWNjZXNzVG9rZW46ICdway5leUoxSWpvaVkyaHBibWMxTmlJc0ltRWlPaUpqYVhOaVptWXlkR013TVROMU1ucHdibk5xTldWcU0ycGxJbjAuazdoLVBVR1g3VGw1eEx3REgzUXBzZydcbiAgfSkuYWRkVG8obWFwKTtcbiAgJChcIiNtYXBcIikuaGlkZSgpO1xuICAkKFwiI21hcFwiKS5mYWRlSW4oKTtcblxuICB2YXIgd2Vla0VnZ0xlZ2VuZCA9IEwuY29udHJvbCh7XG4gICAgcG9zaXRpb246ICdib3R0b21yaWdodCdcbiAgfSk7XG5cbiAgd2Vla0VnZ0xlZ2VuZC5vbkFkZCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZGl2ID0gTC5Eb21VdGlsLmNyZWF0ZSgnZGl2JywgJ2luZm8gbGVnZW5kJyksXG4gICAgICBncmFkZXMgPSBbMCwgMSwgNTAsIDEwMCwgMTUwLCAyMDBdO1xuXG4gICAgZGl2LmlubmVySFRNTCArPSAnPHNwYW4gY2xhc3MgPSBcImxlZ2VuZC1oZWFkZXJcIj7mjZXnjbLmlbjvvIjlgIvvvIk8aHI+JztcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGdyYWRlcy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGdyYWRlc1tpXSA9PT0gMCkge1xuICAgICAgICBkaXYuaW5uZXJIVE1MICs9ICc8ZGl2IGNsYXNzPVwiIGJhcnJlbF9sZWdlbmRcIiBpZD1cImdyYWRlXycgKyBpICsgJ1wiPicgKyAnPGkgc3R5bGU9XCJiYWNrZ3JvdW5kOicgKyBnZXRJY29uU3R5bGVSR0JBKGdyYWRlc1tpXSkgKyAnXCI+PC9pPicgKyBncmFkZXNbaV0gKyAnPGJyPjwvZGl2Pic7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkaXYuaW5uZXJIVE1MICs9ICc8ZGl2IGNsYXNzPVwiIGJhcnJlbF9sZWdlbmRcIiBpZD1cImdyYWRlXycgKyBpICsgJ1wiPicgKyAnPGkgc3R5bGU9XCJiYWNrZ3JvdW5kOicgKyBnZXRJY29uU3R5bGVSR0JBKGdyYWRlc1tpXSkgKyAnXCI+PC9pPicgKyBncmFkZXNbaV0gKyAoZ3JhZGVzW2kgKyAxXSA/ICcgJm5kYXNoOyAnICsgKGdyYWRlc1tpICsgMV0gLSAxKSArICc8YnI+PC9kaXY+JyA6ICcgPGJyPjwvZGl2PicpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGRpdi5pbm5lckhUTUwgKz0gJzxkaXYgY2xhc3M9XCIgYmFycmVsX2xlZ2VuZFwiIGlkPVwiZ3JhZGVfb3RoZXJcIj4nICsgJzxpIHN0eWxlPVwiYmFja2dyb3VuZDojY2NjY2NjXCI+PC9pPicgKyAn54Sh6LOH5paZJyArICc8YnI+PC9kaXY+JztcblxuICAgIHJldHVybiBkaXY7XG4gIH07XG5cbiAgd2Vla0VnZ0xlZ2VuZC5hZGRUbyhtYXApO1xuICAkKFwiLmJhcnJlbF9sZWdlbmQgPiBpbnB1dFwiKS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgc2VsZWN0ZWRDbGFzcyA9ICcuJyArICQodGhpcykudmFsKClcbiAgICBpZiAoJCh0aGlzKS5wcm9wKFwiY2hlY2tlZFwiKSkge1xuICAgICAgJChzZWxlY3RlZENsYXNzKS5jc3MoJ2Rpc3BsYXknLCAnYmxvY2snKVxuICAgIH0gZWxzZSB7XG4gICAgICAkKHNlbGVjdGVkQ2xhc3MpLmNzcygnZGlzcGxheScsICdub25lJylcbiAgICB9XG4gIH0pXG59XG5cbmZ1bmN0aW9uIGRhdGVwaWNrZXJPbkNoYW5nZSgpIHtcbiAgbGV0IGF2YWlsYWJsZURhdGVzSW5JbnRlcnZhbCA9IFtdXG4gIGxldCBkYXRhSW5JbnRlcnZhbCA9IHt9XG4gIGNvbnN0IHN0YXJ0RGF0ZSA9IG1vbWVudCgkKCcucmFuZ2Utc3RhcnQnKS52YWwoKSlcbiAgY29uc3QgZW5kRGF0ZSA9IG1vbWVudCgkKCcucmFuZ2UtZW5kJykudmFsKCkpXG4gIGNvbnN0IGV2ZW50cyA9IGV2ZW50SnNvbi5zbGljZSgpLmZpbHRlcigoZCkgPT4ge1xuICAgIGNvbnN0IGV2ZW50RGF0ZSA9IG1vbWVudC50eihkLmNyZWF0ZWRfYXQsICdBc2lhL1RhaXBlaScpXG4gICAgcmV0dXJuIGV2ZW50RGF0ZSA8PSBlbmREYXRlICYmIGV2ZW50RGF0ZSA+PSBzdGFydERhdGVcbiAgfSlcblxuICBpZiggc3RhcnREYXRlPT09JycgfHwgZW5kRGF0ZSA9PT0gJycpXG4gICAgcmV0dXJuXG5cbiAgYXZhaWxhYmxlRGF0ZXMuZm9yRWFjaCgoZCkgPT4ge1xuICAgIGxldCB0aGlzRGF5ID0gbW9tZW50KGQpXG4gICAgaWYgKHRoaXNEYXkgPj0gc3RhcnREYXRlICYmIHRoaXNEYXkgPD0gZW5kRGF0ZSkge1xuICAgICAgYXZhaWxhYmxlRGF0ZXNJbkludGVydmFsLnB1c2godGhpc0RheSlcbiAgICB9XG4gIH0pXG5cbiAgYXZhaWxhYmxlRGF0ZXNJbkludGVydmFsLmZvckVhY2goKGQpID0+IHtcbiAgICBsZXQgdGhpc0RheUtleSA9IGQuZm9ybWF0KCdZWVlZLU1NLUREJylcbiAgICBkYXRhSW5JbnRlcnZhbFt0aGlzRGF5S2V5XSA9IGdldENvdW50KHRoaXNEYXlLZXkpXG4gIH0pXG5cblxuICBcblxuICBpbnNlcnRCdWNrZXRMaXN0KGRhdGFJbkludGVydmFsKTtcbiAgcmVuZGVyRXZlbnQoZXZlbnRzKVxufVxuXG5mdW5jdGlvbiBpbnNlcnRCdWNrZXRMaXN0KGRhdGVEYXRhTWFwKSB7XG4gIGNvbnN0IGhhc1N0YXJ0RGF0ZSA9ICEoJCgnLnJhbmdlLXN0YXJ0JykudmFsKCkgPT09ICcnKVxuICBjb25zdCBoYXNFbmREYXRlID0gISgkKCcucmFuZ2UtZW5kJykudmFsKCkgPT09ICcnKVxuICBjb25zdCBzdGFydERhdGUgPSBoYXNTdGFydERhdGUgPyBtb21lbnQoJCgnLnJhbmdlLXN0YXJ0JykudmFsKCkpLmZvcm1hdCgnWVlZWS1NTS1ERCcpIDogJ+acqumBuOaTh+i1t+Wni+aXpeacnydcbiAgY29uc3QgZW5kRGF0ZSA9IGhhc0VuZERhdGUgPyBtb21lbnQoJCgnLnJhbmdlLWVuZCcpLnZhbCgpKS5mb3JtYXQoJ1lZWVktTU0tREQnKSA6ICfmnKrpgbjmk4fntZDmnZ/ml6XmnJ8nXG4gICQoXCIubWFwLWNvbnRhaW5lciAubGlzdC1ncm91cFwiKS5lbXB0eSgpO1xuICBjbGVhck1hcCgpO1xuXG4gIGlmIChnZXRLZXlzKGRhdGVEYXRhTWFwKS5sZW5ndGggPT09IDApIHtcbiAgICBsZXQgaW5mbyA9ICfmspLmnInos4fmlpknXG4gICAgaWYgKCFoYXNFbmREYXRlIHx8ICFoYXNTdGFydERhdGUpIHtcbiAgICAgIGluZm8gPSAnJ1xuICAgIH1cbiAgICBzZXRNYXBUaXRsZShgJHtzdGFydERhdGV9IH4gJHtlbmREYXRlfSAke2luZm99YClcbiAgfSBlbHNlIHtcbiAgICBzZXRNYXBUaXRsZShgJHtzdGFydERhdGV9IH4gJHtlbmREYXRlfSDljYDplpPos4fmlplgKVxuICB9XG5cbiAgZm9yIChsZXQgZGF0ZSBpbiBkYXRlRGF0YU1hcCkge1xuICAgIGxldCB0aGlzRGF5Q291bnREYXRhID0gZGF0ZURhdGFNYXBbZGF0ZV1cbiAgICBmb3IgKGxldCBpZCBpbiB0aGlzRGF5Q291bnREYXRhKSB7XG4gICAgICBjb25zdCBjb3VudCA9IHRoaXNEYXlDb3VudERhdGFbaWRdXG4gICAgICBjb25zdCBsYW1wID0gYnVja2V0SnNvbi5maW5kKChkKSA9PiB7XG4gICAgICAgIHJldHVybiBkLmxhbXBfaWQgPT09IGlkXG4gICAgICB9KVxuICAgICAgY29uc3QgcGxhY2UgPSBnZXRQbGFjZU5hbWUobGFtcC5wbGFjZV9pZClcbiAgICAgIGluc2VydEJ1Y2tldEh0bWwocGxhY2UsIGxhbXAsIGNvdW50KTtcbiAgICAgIGJpbmRQb3B1cHMobGFtcCwgY291bnQpO1xuICAgIH1cbiAgfVxuXG4gICQoJyNtYXAnKS5mYWRlSW4oKVxufVxuXG5mdW5jdGlvbiBpbnNlcnRCdWNrZXRIdG1sKGluZm8sIGJ1Y2tldCwgY291bnQpIHtcbiAgdmFyIGluc2VydEhUTUwgPSBgPGEgY2xhc3M9XCJsaXN0LWdyb3VwLWl0ZW0gXCI+XG4gICAgICAgIDxoNCBjbGFzcz1cImxpc3QtZ3JvdXAtaXRlbS1oZWFkaW5nXCI+PHNwYW4+JHtidWNrZXQubGFtcF9pZH1AJHtpbmZvfTwvc3Bhbj48c3Bhbj4mIzk4ODk7JHtjb3VudH08L3NwYW4+PC9oND5cbiAgICAgICAgPHAgY2xhc3M9XCJsaXN0LWdyb3VwLWl0ZW0tdGV4dFwiPiAke21vbWVudC50eihidWNrZXQudXBkYXRlZF9hdCwgJ0FzaWEvVGFpcGVpJykuZm9ybWF0KCdMTEwnKX08L3A+XG4gICAgICA8L2E+YFxuICAkKFwiLm1hcC1jb250YWluZXIgLmxpc3QtZ3JvdXBcIikuYXBwZW5kKGluc2VydEhUTUwpO1xufVxuXG5mdW5jdGlvbiBnZXRLZXlzKG9iaikge1xuICB0cnkge1xuICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqKTtcbiAgICByZXR1cm4ga2V5cztcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgcmV0dXJuIFtdO1xuICB9XG59XG5cbmZ1bmN0aW9uIHNldE1hcFRpdGxlKG1hcFRpdGxlKSB7XG4gIC8vIGNsZWFyIGxvYWRpbmcgdGV4dCBcbiAgY29uc29sZS5sb2coJ3NldCB0aXRsZScsIG1hcFRpdGxlKVxuICBjb25zdCB0aXRsZSA9ICQoYDxoMz4ke21hcFRpdGxlfTwvaDM+YClcbiAgJCgnLmxpc3QtZ3JvdXAnKS5lbXB0eSgpXG4gICQoJy5saXN0LWdyb3VwJykuYXBwZW5kKHRpdGxlKVxuICBcbiAgdGl0bGUuaGlkZSgpO1xuICB0aXRsZS5mYWRlSW4oJ3Nsb3cnKTtcbn1cblxuZnVuY3Rpb24gcmVuZGVyRXZlbnQoZXZlbnRzKSB7XG4gIGV2ZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChldmVudCkge1xuICAgIHZhciBsYXRsbmcgPSBbZXZlbnQubWNjX2NlbnRlclsxXSwgZXZlbnQubWNjX2NlbnRlclswXV1cbiAgICB2YXIgcmFkaXVzID0gbWNjRGlzdGFuY2VMb3dlckxpbWl0XG4gICAgdmFyIGNpcmNsZSA9IEwuY2lyY2xlKGxhdGxuZywge1xuICAgICAgcmFkaXVzOiByYWRpdXNcbiAgICB9KVxuICAgIGNpcmNsZXMucHVzaChjaXJjbGUpXG4gICAgY2lyY2xlLmFkZFRvKG1hcCk7XG4gIH0pXG59XG5cbmZ1bmN0aW9uIGNsZWFyTWFwKCkge1xuICBtYXJrZXJBcnJheS5mb3JFYWNoKGZ1bmN0aW9uIChtYXJrZXIpIHtcbiAgICBtYXAucmVtb3ZlTGF5ZXIobWFya2VyKTtcbiAgfSk7XG5cbiAgY2lyY2xlcy5mb3JFYWNoKGZ1bmN0aW9uIChjaXJjbGUpIHtcbiAgICBjaXJjbGUucmVtb3ZlKClcbiAgfSlcblxuICBjaXJjbGVzID0gW11cblxuICAkKFwiI21hcFwiKS5oaWRlKCk7XG59XG5cbmZ1bmN0aW9uIGJpbmRQb3B1cHMobGFtcCwgY291bnQpIHtcblxuICB2YXIgU0NBTEUgPSA4MDtcblxuXG4gIHZhciBsYXQgPSBsYW1wLmxhbXBfbG9jYXRpb25bMV1cbiAgdmFyIGxuZyA9IGxhbXAubGFtcF9sb2NhdGlvblswXVxuXG4gIHZhciBpY29uID0gTC5pY29uKHtcbiAgICBpY29uVXJsOiBnZXRJY29uU3R5bGUoY291bnQpLFxuICAgIGljb25TaXplOiBbNDUsIDgwXSwgLy8gc2l6ZSBvZiB0aGUgaWNvblxuICAgIHBvcHVwQW5jaG9yOiBbMCwgLTQwXSxcbiAgICBpY29uQW5jaG9yOiBbMjIsIDYwXSxcbiAgICBjbGFzc05hbWU6IGdldEljb25DYXQoY291bnQpLFxuICB9KTtcblxuICB2YXIgUG9wVXBDb250ZW50ID0gKCc8dGFibGU+JyArXG4gICAgJzx0cj4nICtcbiAgICAnPHRoPiBJRCA8L3RoPicgK1xuICAgICc8dGQ+IHswfSA8L3RkPicgK1xuICAgICc8L3RyPicgK1xuICAgICc8dHI+JyArXG4gICAgJzx0aD7lnLDpu548L3RoPicgK1xuICAgICc8dGQ+ezF9PC90ZD4nICtcbiAgICAnPC90cj4nICtcbiAgICAnPHRyPicgK1xuICAgICc8dGg+5o2V542yPC90aD4nICtcbiAgICAnPHRkPnsyfTwvdGQ+JyArXG4gICAgJzwvdHI+JyArXG4gICAgJzwvdGFibGU+JykuZm9ybWF0KGxhbXAubGFtcF9pZCwgZ2V0UGxhY2VOYW1lKGxhbXAucGxhY2VfaWQpLCBjb3VudClcblxuICB2YXIgbWFya2VyID0gTC5tYXJrZXIoW2xhdCwgbG5nXSwge1xuICAgICAgaWNvbjogaWNvblxuICAgIH0pXG4gICAgLmJpbmRQb3B1cChQb3BVcENvbnRlbnQpLmFkZFRvKG1hcCk7XG4gIG1hcmtlckFycmF5LnB1c2gobWFya2VyKTtcbn1cblxuZnVuY3Rpb24gZ2V0SWNvblN0eWxlKGFtb3VudCkge1xuICB2YXIgc3R5bGU7XG4gIGlmIChhbW91bnQgPT09IDApIHtcbiAgICBzdHlsZSA9ICdsZWdlbmQxJztcbiAgfSBlbHNlIGlmIChhbW91bnQgPiAwICYmIGFtb3VudCA8PSA0OSkge1xuICAgIHN0eWxlID0gJ2xlZ2VuZDInO1xuICB9IGVsc2UgaWYgKGFtb3VudCA+PSA1MCAmJiBhbW91bnQgPD0gOTkpIHtcbiAgICBzdHlsZSA9ICdsZWdlbmQzJztcbiAgfSBlbHNlIGlmIChhbW91bnQgPj0gMTAwICYmIGFtb3VudCA8PSAxNDkpIHtcbiAgICBzdHlsZSA9ICdsZWdlbmQ0JztcbiAgfSBlbHNlIGlmIChhbW91bnQgPj0gMTUwICYmIGFtb3VudCA8PSAxOTkpIHtcbiAgICBzdHlsZSA9ICdsZWdlbmQ1JztcbiAgfSBlbHNlIGlmIChhbW91bnQgPj0gMjAwKSB7XG4gICAgc3R5bGUgPSAnbGVnZW5kNic7XG4gIH0gZWxzZSB7XG4gICAgc3R5bGUgPSAnbGVnZW5kX3VuZGVmaW5lZCc7XG4gIH1cbiAgcmV0dXJuICdpbWFnZXMvJyArIHN0eWxlICsgJy5zdmcnO1xufVxuXG5mdW5jdGlvbiBnZXRJY29uQ2F0KGFtb3VudCkge1xuICB2YXIgY2F0ZWdvcnk7XG4gIGlmIChhbW91bnQgPT09IDApIHtcbiAgICBjYXRlZ29yeSA9ICdncmFkZV8wJztcbiAgfSBlbHNlIGlmIChhbW91bnQgPiAwICYmIGFtb3VudCA8PSA0OSkge1xuICAgIGNhdGVnb3J5ID0gJ2dyYWRlXzEnO1xuICB9IGVsc2UgaWYgKGFtb3VudCA+PSA1MCAmJiBhbW91bnQgPD0gOTkpIHtcbiAgICBjYXRlZ29yeSA9ICdncmFkZV8yJztcbiAgfSBlbHNlIGlmIChhbW91bnQgPj0gMTAwICYmIGFtb3VudCA8PSAxNDkpIHtcbiAgICBjYXRlZ29yeSA9ICdncmFkZV8zJztcbiAgfSBlbHNlIGlmIChhbW91bnQgPj0gMTUwICYmIGFtb3VudCA8PSAxOTkpIHtcbiAgICBjYXRlZ29yeSA9ICdncmFkZV80JztcbiAgfSBlbHNlIGlmIChhbW91bnQgPj0gMjAwKSB7XG4gICAgY2F0ZWdvcnkgPSAnZ3JhZGVfNSc7XG4gIH0gZWxzZSB7XG4gICAgY2F0ZWdvcnkgPSAnZ3JhZGVfb3RoZXInO1xuICB9XG4gIHJldHVybiBjYXRlZ29yeTtcbn1cblxuZnVuY3Rpb24gZ2V0SWNvblN0eWxlUkdCQShhbW91bnQpIHtcbiAgdmFyIHN0eWxlO1xuICBpZiAoYW1vdW50ID09PSAwKSB7XG4gICAgc3R5bGUgPSAnIzAwRkY5RCc7XG4gIH0gZWxzZSBpZiAoYW1vdW50ID4gMCAmJiBhbW91bnQgPD0gNDkpIHtcbiAgICBzdHlsZSA9ICcjMzNDQzdFJztcbiAgfSBlbHNlIGlmIChhbW91bnQgPj0gNTAgJiYgYW1vdW50IDw9IDk5KSB7XG4gICAgc3R5bGUgPSAnIzY2OTk1RSc7XG4gIH0gZWxzZSBpZiAoYW1vdW50ID49IDEwMCAmJiBhbW91bnQgPD0gMTQ5KSB7XG4gICAgc3R5bGUgPSAnIzk5NjYzRic7XG4gIH0gZWxzZSBpZiAoYW1vdW50ID49IDE1MCAmJiBhbW91bnQgPD0gMTk5KSB7XG4gICAgc3R5bGUgPSAnI0NDMzMxRic7XG4gIH0gZWxzZSBpZiAoYW1vdW50ID49IDIwMCkge1xuICAgIHN0eWxlID0gJyNGRjAwMDAnO1xuICB9XG5cbiAgcmV0dXJuIHN0eWxlO1xufSJdfQ==\n"]}