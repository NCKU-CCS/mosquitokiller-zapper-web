!function n(r,e,t){function a(i,c){if(!e[i]){if(!r[i]){var d="function"==typeof require&&require;if(!c&&d)return d(i,!0);if(o)return o(i,!0);var u=new Error("Cannot find module '"+i+"'");throw u.code="MODULE_NOT_FOUND",u}var l=e[i]={exports:{}};r[i][0].call(l.exports,function(n){var e=r[i][1][n];return a(e||n)},l,l.exports,n,r,e,t)}return e[i].exports}for(var o="function"==typeof require&&require,i=0;i<t.length;i++)a(t[i]);return a}({1:[function(n,r,e){"use strict";function t(){T=L.map("map").setView(E["台南"],14),L.tileLayer("https://api.mapbox.com/styles/v1/mapbox/dark-v9/tiles/256/{z}/{x}/{y}?access_token={accessToken}",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',maxZoom:18,id:"ching56.17hng6ja",accessToken:"pk.eyJ1IjoiY2hpbmc1NiIsImEiOiJjaXNiZmYydGMwMTN1MnpwbnNqNWVqM2plIn0.k7h-PUGX7Tl5xLwDH3Qpsg"}).addTo(T),$("#map").hide(),$("#map").fadeIn();var n=L.control({position:"bottomright"});n.onAdd=function(){var n=L.DomUtil.create("div","info legend"),r=[0,1,50,100,150,200];n.innerHTML+='<span class = "legend-header">捕獲數（個）<hr>';for(var e=0;e<r.length;e++)n.innerHTML+=0===r[e]?'<div class=" barrel_legend" id="grade_'+e+'"><i style="background:'+m(r[e])+'"></i>'+r[e]+"<br></div>":'<div class=" barrel_legend" id="grade_'+e+'"><i style="background:'+m(r[e])+'"></i>'+r[e]+(r[e+1]?" &ndash; "+(r[e+1]-1)+"<br></div>":" <br></div>");return n.innerHTML+='<div class=" barrel_legend" id="grade_other"><i style="background:#cccccc"></i>無資料<br></div>',n},n.addTo(T)}function a(){var n={},r=moment($(".range-start").val()),e=moment($(".range-end").val()),t=h.slice().filter(function(n){var t=moment.tz(n.created_at,"Asia/Taipei");return t<=e&&t>=r});""!==r&&""!==e&&(D.forEach(function(t){var a=moment(t);if(a>=r&&a<=e){var o=a.format("YYYY-MM-DD");n[o]=w(o)}}),o(n),u(t))}function o(n){var r=!(""===$(".range-start").val()),e=!(""===$(".range-end").val()),t=r?moment($(".range-start").val()).format("YYYY-MM-DD"):"未選擇起始日期",a=e?moment($(".range-end").val()).format("YYYY-MM-DD"):"未選擇結束日期",o={};if($(".map-container .list-group").empty(),l(),0===c(n).length){var u="沒有資料";e&&r||(u=""),d(t+" ~ "+a+" "+u)}else d(t+" ~ "+a+" 區間資料");for(var p in n){var f=n[p];for(var m in f)!function(n){var r=f[n],e=g.find(function(r){return r.lamp_id===n});i(Y(e.place_id),e,r,p),o[e.lamp_id]||(o[e.lamp_id]={},o[e.lamp_id].lamp=e,o[e.lamp_id].count=0);var t=o[e.lamp_id].count;o[e.lamp_id].count=t+r}(m)}s(o),$("#map").fadeIn()}function i(n,r,e,t){var a='<a class="list-group-item ">\n        <h4 class="list-group-item-heading"><span>'+r.lamp_id+"@"+n+"</span><span>&#9889;"+e+'</span></h4>\n        <p class="list-group-item-text"> '+moment(t).format("LL")+"</p>\n      </a>";$(".map-container .list-group").append(a)}function c(n){try{return Object.keys(n)}catch(n){return[]}}function d(n){var r=$("<h3>"+n+"</h3>");$(".list-group").empty(),$(".list-group").append(r),r.hide(),r.fadeIn("slow")}function u(n){n.forEach(function(n){var r=[n.mcc_center[1],n.mcc_center[0]],e=b,t=L.circle(r,{radius:e});x.push(t),t.addTo(T)})}function l(){M.forEach(function(n){T.removeLayer(n)}),x.forEach(function(n){n.remove()}),x=[],$("#map").hide()}function s(n){for(var r in n){var e=n[r].lamp,t=n[r].count,a=e.lamp_location[1],o=e.lamp_location[0],i=L.icon({iconUrl:p(t),iconSize:[45,80],popupAnchor:[0,-40],iconAnchor:[22,60],className:f(t)}),c="<table>\n      <tr>\n        <th> ID </th>\n        <td> "+e.lamp_id+" </td>\n      </tr>\n      <tr>\n        <th>地點</th>\n        <td>"+Y(e.place_id)+"</td>\n      </tr>\n        <tr>\n        <th>捕獲</th>\n        <td>"+t+"</td>\n      </tr>\n      </table>",d=L.marker([a,o],{icon:i}).bindPopup(c).addTo(T);M.push(d)}if(M.length>0){var u=new L.featureGroup(M);T.fitBounds(u.getBounds())}}function p(n){return"images/"+(0===n?"legend1":n>0&&n<=49?"legend2":n>=50&&n<=99?"legend3":n>=100&&n<=149?"legend4":n>=150&&n<=199?"legend5":n>=200?"legend6":"legend_undefined")+".svg"}function f(n){return 0===n?"grade_0":n>0&&n<=49?"grade_1":n>=50&&n<=99?"grade_2":n>=100&&n<=149?"grade_3":n>=150&&n<=199?"grade_4":n>=200?"grade_5":"grade_other"}function m(n){var r=void 0;return 0===n?r="#00FF9D":n>0&&n<=49?r="#33CC7E":n>=50&&n<=99?r="#66995E":n>=100&&n<=149?r="#99663F":n>=150&&n<=199?r="#CC331F":n>=200&&(r="#FF0000"),r}var v=function(){function n(n,r){var e=[],t=!0,a=!1,o=void 0;try{for(var i,c=n[Symbol.iterator]();!(t=(i=c.next()).done)&&(e.push(i.value),!r||e.length!==r);t=!0);}catch(n){a=!0,o=n}finally{try{!t&&c.return&&c.return()}finally{if(a)throw o}}return e}return function(r,e){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return n(r,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),g=[],h=[],_=[],y=[],b=void 0,T=void 0,M=[],x=[],Y=void 0,w=void 0,D=void 0,E={"台南":[22.9971,120.1926],"高雄":[22.6397615,120.2999183],"屏東":[22.667431,120.486307]},k=function(n){var r={};return n.forEach(function(n){r[n.place_id]=n.place_name}),function(n){return r[n]}},I=function(n){var r={};D.forEach(function(n){r[n]={}});for(var e in n){var t=n[e];for(var a in t)r[e][a]=+t[a].sum}return function(n){return r[n]}};moment.locale("zh-tw"),$(document).ready(function(){d("資料載入中..."),$(".range-start, .range-end").datepicker({autoclose:!0,zIndexOffset:1e3,format:"yyyy-mm-dd",disableTouchKeyboard:!0}).on("changeDate",a);var n=["lamps","rules","mcc","counts?formatBy=date","places"].map(function(n){return $.ajax({url:"http://140.116.249.228:3000/apis/"+n,dataType:"JSON",type:"GET"})});Promise.all(n).then(function(n){console.log(n);var r=void 0,e=v(n,5);g=e[0],r=e[1],h=e[2],_=e[3],y=e[4],b=r[0].distance_lower_limit,D=c(_),Y=k(y),w=I(_),t(),d("請選擇日期區間")}).catch(function(n){console.log(n),d("資料錯誤："+n.status+" "+n.statusText)})})},{}]},{},[1]);
//# sourceMappingURL=maps/app.js.map
