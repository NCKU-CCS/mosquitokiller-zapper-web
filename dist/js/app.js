!function e(n,r,t){function a(i,c){if(!r[i]){if(!n[i]){var d="function"==typeof require&&require;if(!c&&d)return d(i,!0);if(o)return o(i,!0);var s=new Error("Cannot find module '"+i+"'");throw s.code="MODULE_NOT_FOUND",s}var l=r[i]={exports:{}};n[i][0].call(l.exports,function(e){var r=n[i][1][e];return a(r||e)},l,l.exports,e,n,r,t)}return r[i].exports}for(var o="function"==typeof require&&require,i=0;i<t.length;i++)a(t[i]);return a}({1:[function(e,n,r){"use strict";function t(){b=L.map("map").setView(I["台南"],14),L.tileLayer("https://api.mapbox.com/styles/v1/mapbox/dark-v9/tiles/256/{z}/{x}/{y}?access_token={accessToken}",{attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',maxZoom:18,id:"ching56.17hng6ja",accessToken:"pk.eyJ1IjoiY2hpbmc1NiIsImEiOiJjaXNiZmYydGMwMTN1MnpwbnNqNWVqM2plIn0.k7h-PUGX7Tl5xLwDH3Qpsg"}).addTo(b),$("#map").hide(),$("#map").fadeIn();var e=L.control({position:"bottomright"});e.onAdd=function(){var e=L.DomUtil.create("div","info legend"),n=[0,1,50,100,150,200];e.innerHTML+='<span class = "legend-header">捕獲數（個）<hr>';for(var r=0;r<n.length;r++)e.innerHTML+=0===n[r]?'<div class=" barrel_legend" id="grade_'+r+'"><i style="background:'+m(n[r])+'"></i>'+n[r]+"<br></div>":'<div class=" barrel_legend" id="grade_'+r+'"><i style="background:'+m(n[r])+'"></i>'+n[r]+(n[r+1]?" &ndash; "+(n[r+1]-1)+"<br></div>":" <br></div>");return e.innerHTML+='<div class=" barrel_legend" id="grade_other"><i style="background:#cccccc"></i>無資料<br></div>',e},e.addTo(b),$(".barrel_legend > input").on("click",function(){var e="."+$(this).val();$(this).prop("checked")?$(e).css("display","block"):$(e).css("display","none")})}function a(){var e=[],n={},r=moment($(".range-start").val()),t=moment($(".range-end").val());console.log("trigger change"),""!==r&&""!==t&&(Y.forEach(function(n){var a=moment(n);a>=r&&a<=t&&e.push(a)}),e.forEach(function(e){var r=e.format("YYYY-MM-DD");n[r]=T(r)}),o(n),s())}function o(e){var n=!(""===$(".range-start").val()),r=!(""===$(".range-end").val()),t=n?moment($(".range-start").val()).format("YYYY-MM-DD"):"未選擇起始日期",a=r?moment($(".range-end").val()).format("YYYY-MM-DD"):"未選擇結束日期";if($(".map-container .list-group").empty(),l(),0===c(e).length){var o="沒有資料";r&&n||(o=""),d(t+" ~ "+a+" "+o)}else d(t+" ~ "+a+" 區間資料");for(var s in e){var u=e[s];for(var f in u)!function(e){var n=u[e],r=g.find(function(n){return n.lamp_id===e});i(x(r.place_id),r,n),p(r,n)}(f)}$("#map").fadeIn()}function i(e,n,r){var t='<a class="list-group-item ">\n        <h4 class="list-group-item-heading"><span>'+n.lamp_id+"@"+e+"</span><span>&#9889;"+r+'</span></h4>\n        <p class="list-group-item-text"> '+moment.tz(n.updated_at,"Asia/Taipei").format("LLL")+"</p>\n      </a>";$(".map-container .list-group").append(t)}function c(e){try{return Object.keys(e)}catch(e){return[]}}function d(e){console.log("set title",e);var n=$("<h3>"+e+"</h3>");$(".list-group").empty(),$(".list-group").append(n),n.hide(),n.fadeIn("slow")}function s(e){v.forEach(function(e){var n=[e.mcc_center[1],e.mcc_center[0]],r=_,t=L.circle(n,{radius:r});k.push(t),t.addTo(b)})}function l(){M.forEach(function(e){b.removeLayer(e)}),k.forEach(function(e){e.remove()}),k=[],$("#map").hide()}function p(e,n){var r=e.lamp_location[1],t=e.lamp_location[0],a=L.icon({iconUrl:u(n),iconSize:[45,80],popupAnchor:[0,-40],iconAnchor:[22,60],className:f(n)}),o="<table><tr><th> ID </th><td> {0} </td></tr><tr><th>地點</th><td>{1}</td></tr><tr><th>捕獲</th><td>{2}</td></tr></table>".format(e.lamp_id,x(e.place_id),n),i=L.marker([r,t],{icon:a}).bindPopup(o).addTo(b);M.push(i)}function u(e){return"images/"+(0===e?"legend1":e>0&&e<=49?"legend2":e>=50&&e<=99?"legend3":e>=100&&e<=149?"legend4":e>=150&&e<=199?"legend5":e>=200?"legend6":"legend_undefined")+".svg"}function f(e){return 0===e?"grade_0":e>0&&e<=49?"grade_1":e>=50&&e<=99?"grade_2":e>=100&&e<=149?"grade_3":e>=150&&e<=199?"grade_4":e>=200?"grade_5":"grade_other"}function m(e){var n;return 0===e?n="#00FF9D":e>0&&e<=49?n="#33CC7E":e>=50&&e<=99?n="#66995E":e>=100&&e<=149?n="#99663F":e>=150&&e<=199?n="#CC331F":e>=200&&(n="#FF0000"),n}String.prototype.format||(String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,function(n,r){return void 0!==e[r]?e[r]:n})});var g={},v={},h={},y={},_=void 0,b=void 0,M=[],k=[],x=void 0,T=void 0,Y=void 0;moment.locale("zh-tw");var D=function(e){var n={};return e.forEach(function(e){n[e.place_id]=e.place_name}),function(e){return n[e]}},E=function(e){var n={};Y.forEach(function(e){n[e]={}});for(var r in e){var t=e[r];for(var a in t)n[r][a]=t[a].sum}return function(e){return n[e]}},I={"台南":[22.9971,120.1926],"高雄":[22.6397615,120.2999183],"屏東":[22.667431,120.486307]};$(document).ready(function(){d("資料載入中..."),$(".range-start").datepicker({autoclose:!0,zIndexOffset:1e3,format:"yyyy-mm-dd"}).on("changeDate",a),$(".range-end").datepicker({autoclose:!0,zIndexOffset:1e3,format:"yyyy-mm-dd"}).on("changeDate",a);var e=["lamps","rules","mcc","counts","places"].map(function(e){return $.ajax({url:e+".json",dataType:"JSON",type:"GET"})});Promise.all(e).then(function(e){g=e[0].lamps,_=e[1].rules[0].distance_lower_limit,v=e[2].mcc,h=e[3].counts,y=e[4].places,console.log(e),Y=c(h),x=D(y),T=E(h),t(),d("請選擇日期區間")})})},{}]},{},[1]);
//# sourceMappingURL=maps/app.js.map
